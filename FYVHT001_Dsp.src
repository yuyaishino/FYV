f' ◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇
'    < 個別アプリケーション用ファイル >
'    画面
' ◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇◇

'*******************************************************************************
'	[共通]タイトル表示
'	引数：
'		strValue$		: 表示文字列
'		ForeColor&		: 文字色
'		BackColor&		: 背景色
'		posX%			: X座標
'		posY%			: Y座標
'	戻り値：なし
'*******************************************************************************
 Sub SetTitle(strValue$, ForeColor&, BackColor&, posX%, posY%)

	SIFont.Reset
	SIFont.Set(Lc.WAT.NORMAL, ForeColor&, BackColor&)
	SIText.Print( posX%, posY%, SpaceUme$(Lc.CENTER, strValue$, 20), Lc.RAT.NORMAL, Lc.BLD.NORMAL)
	SIFont.Reset

 End Sub

'*******************************************************************************
'	[共通]タイトル表示
'	引数：
'		strValue$		: 表示文字列
'		ForeColor&		: 文字色
'		BackColor&		: 背景色
'		posX%			: X座標
'		posY%			: Y座標
'	戻り値：なし
'*******************************************************************************
 Sub SetTitle2(strValue$, ForeColor&, BackColor&, posX%, posY%)

	SIFont.Reset
	SIFont.Set(Lc.WAT.HEIGHT, ForeColor&, BackColor&)
	SIText.Print( posX%, posY%, SpaceUme$(Lc.CENTER, strValue$, 20), Lc.RAT.NORMAL, Lc.BLD.BOLD)
	SIFont.Reset

 End Sub


'*******************************************************************************
'*******************************************************************************
'	[0000]ﾒﾆｭｰ
'	引数：なし
'	戻り値：なし
'*******************************************************************************
 Sub Scrn.MainMenu
	DIM W$
	DIM strDefInKey$[10], strInKey$[15]
	DIM strListData$(8)[25]
	DIM intListCnt%

	'削除一覧初期化'
	g.intPage& = 0
	if g.strSetting$ <> "2" THEN
		g.strSetting$ = "1"
	endif

	'担当者が入っていたら'
	if WUJskWk.Cnt& > 0 THEN
		WUJskWk.Get(0)
		g.strWorkUser$ = g.WUJskWk.1$
	endif

	'設定値が入っていたら'
	if SEJskWk.Cnt& > 0 THEN
		SEJskWk.Get(0)
		g.strSetting$ = g.SEJskWk.1$
	endif

	'ﾒﾆｭｰ項目を登録
	strDefInKey$ = "1"
	strListData$(1) = "１:担当者入力       1"
	IF g.strWorkUser$ = "" Then
		strListData$(2) = "                     "
		strListData$(3) = "                     "
		strListData$(4) = "                     "
	Else
		if g.strSetting$ = "1" THEN
			strListData$(2) = "２:集荷作業*        2"
		ELSE
			strListData$(2) = "２:集荷作業         2"
		endif
		strListData$(3) = "３:指示集荷作業     3"
		strDefInKey$ = strDefInKey$ + "23"

		IF KEJISK.Cnt& > 0 Then
			strListData$(4) = "４:欠品集荷作業     4"
			strDefInKey$ = strDefInKey$ + "4"
		ELSE
			strListData$(4) = "                    "
		endif
	END IF
	IF KEJISK.Cnt& > 0 Then
		strListData$(5) = "５:欠品削除         5"
		strDefInKey$ = strDefInKey$ + "5"
	ELSE
		strListData$(5) = "                    "
	endif

	IF SYJISK.Cnt& > 0 Then
		strListData$(6) = "６:集荷実績送信     6"
		strDefInKey$ = strDefInKey$ + "6"
	Else
		strListData$(6) = "                    "
	Endif

	if SIJISK.Cnt& > 0 THEN
		strListData$(7) = "                    "
	Else
		strListData$(7) = "７:設定             7"
		strDefInKey$ = strDefInKey$ + "7"
	Endif

	strListData$(8) = "９:終了             9"
	strDefInKey$ = strDefInKey$ + "9"

	'ﾒﾆｭｰ項目数
	intListCnt% = 8


	SIList.Cursor& = 1		'配列内のカーソルの行
	SIList.TopPos& = 1		'スクリーンのTOP行

	'エラーコード初期化
	g.intFail% = 0

	'画面処理
	WHILE strSyoriHensu$ = "0000"
		strInKey$ = strDefInKey$

		Cls


		'タイトル表示
		CALL SetTitle(MainMenu.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)

		'サブタイトル表示
		SIText.Print(1,3, "メニュー            ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print(14, 3, g.strWorkUser$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)

		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "▲▼:スクロール      ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "M1:確定             ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIFont.Reset
		'リスト表示 & 入力待ち
		strInKey$ = strInKey$ + M1.KEY + ENT.KEY + SFF1.KEY + SFF2.KEY
		'strInKey$ = strInKey$ + M1.KEY + ENT.KEY
		W$ = SIList$( 1, 6, 8, 20, strListData$, intListCnt%, strInKey$)

		'キー入力確認
		IF W$ = M1.KEY OR W$ = ENT.KEY THEN
			'選択されたリスト項目Noを取得
			W$ = MID$(strListData$(SIList.Cursor&),21,1)
		END IF
		SELECT W$
			CASE "1"  '担当者入力
				'[1010]担当者QR
				NextScreen.Set("1010")
			CASE "2"  '集荷作業

				if g.strSetting$ = "2" THEN
					'[2010]かんばん読取(指示書作成なし)
					NextScreen.Set("2010")
				ELSE
					'指示書作成実績有り'
					if SIJISK.Cnt& > 0 THEN
						'[2015]かんばん読取(指示書作成有り)
						NextScreen.Set("2015")
					ELSE
						'指示書実績無し'
						'[2000]かんばん読取
						NextScreen.Set("2000")
					endif
				endif

			CASE "3"  '指示集荷作業
				'[3000]指示QR読取
				NextScreen.Set("3000")

			CASE "4"  '欠品集荷作業
				'[4000]欠品集荷作業
				NextScreen.Set("4000")

			CASE "5"  '欠品削除
				'[5000]欠品削除
				NextScreen.Set("5000")

			CASE "6"  '集荷実績送信
				if SIJISK.Cnt& > 0 THEN
					'----------------送信確認popup----------------'
					SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
					Call NG.Beep
					SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Green, Lc.Col.Black, Lc.Col.Lime, Lc.Col.Black, Lc.Col.20Gray)
					iMsg.Text$(1) = "未集荷の指示書が"
					iMsg.Text$(2) = "存在します。"
					iMsg.Text$(3) = "送信しますか?"
					IF SIMsgBox.PopUp$(7, "送信確認", iMsg.Text$(), 3, Lc.MSG.YESNO) = M1.KEY  Then
						'[6000]集荷実績送信
						NextScreen.Set("6000")
					END IF
				ELSE
					'[6000]集荷実績送信
					NextScreen.Set("6000")
				ENDIF

			CASE "7"  '設定
				'[7000]設定
				NextScreen.Set("7000")
			CASE "9"  '終了
				'[9999]終了
				NextScreen.Set("9999")

			'隠しｺﾏﾝﾄﾞ「SISET.PD4」を起動
			Case SFF1.KEY
				If fRecCount&("SISET.PD4") <> -1 Then
					CHAIN "SISET.PD4"
				Endif

			'隠しｺﾏﾝﾄﾞ「SIVerCtl.PD4」を起動
			Case SFF2.KEY
				If fRecCount&("SIVerCtl.PD4") <> -1 Then
					CHAIN "SIVerCtl.PD4"
				Endif
		END SELECT
	WEND

 End Sub


'*************************************************************************************************************************************************
'	[1010]担当コード読取
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
	Sub Scrn.InputWorkUser
	DIM W$
	DIM intPos%
	DIM iRet%
	DIM CODE$

	WHILE strSyoriHensu$ = "1010"

		Cls

		'--固定部分
		'タイトル表示
		CALL SetTitle(Shokuban.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)

		SIText.Print( 1, 8, "  職番ＱＲを      ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 10, "  読取ってください    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1,15, "  職番:             ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "職番QRを読取        ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "M1:確定      M2:ﾒﾆｭｰ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)

		SIFont.Reset

		'---------------------------
		'	入力待ち
		'---------------------------
		'入力待ち(M1 or M2 or QR)
		W$ = FunTextBox$(9, 8, g.strWorkUser$, "CCCCCCC", 0, M1.KEY + M2.KEY, 1, 0, "Q:")

		IF strQR$ <> "" THEN
			'----- QR入力 -----
			'担当者QRかチェック(桁数:7)
			IF Len(strQR$) = 7 THEN
				'担当者消す'
				WUJskWk.Kill
				g.strWorkUser$ = strQR$
				g.WUJskWk.1$ = strQR$
				'担当者入れる'
				WUJskWk.Put(0)
				'メニュー
				NextScreen.Set("0000")
			ELSE
				'----- 担当者QR以外 -----
				Call NG.Beep

				'ポップアップ表示
				SIFont.Set(Lc.WAT.NORMAL, Lc.COL.BLACK, Lc.COL.WHITE)
				SIMsgBox.SetColor(Lc.COL.WHITE, Lc.Col.Red, Lc.COL.BLACK, Lc.Col.Pink, Lc.COL.BLACK, Lc.Col.20Gray)
				iMsg.Text$(1) = "職番QR"
				iMsg.Text$(2) = "ではありません"
				IF SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY THEN	'QRエラー
				END IF

			END IF

		ELSE
			'----- キー入力 -----
			SELECT CASE W$
				CASE M1.KEY
					'----- 確定 -----
					'入力チェック(桁数:7)
					IF Len(strKEY$) = 7 THEN
						'----- チェックOK -----
						'g.strWorkUser$ = strKEY$		'担当者No
						'担当者消す'
						WUJskWk.Kill
						g.strWorkUser$ = strKEY$
						g.WUJskWk.1$ = strKEY$
						'担当者入れる'
						WUJskWk.Put(0)
						'メニュー
						NextScreen.Set("0000")
					ELSE
						'----- チェックNG -----
						Call NG.Beep
						'ポップアップ表示
						SIFont.Set(Lc.WAT.NORMAL, Lc.COL.BLACK, Lc.COL.WHITE)
						SIMsgBox.SetColor(Lc.COL.WHITE, Lc.Col.Red, Lc.COL.BLACK, Lc.Col.Pink, Lc.COL.BLACK, Lc.Col.20Gray)
						iMsg.Text$(1) = "職番ｺｰﾄﾞを"
						iMsg.Text$(2) = "7桁で"
						iMsg.Text$(3) = "入力してください"
						IF SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 3, Lc.MSG.OKONLY) = M1.KEY THEN
						END IF
					END IF
				CASE M2.KEY
					'[0000]メインメニュー
					NextScreen.Set("0000")

			END SELECT
		END IF
	WEND

	End Sub


'=========================================↓集荷作業============================================================================================================================='

'*************************************************************************************************************************************************
'	[2000]かんばん読取指示書作成
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.CreateKanban

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	Private strWhere$(6)[50] 'ファイルサーチ条件集荷
	Private strWhereSyuka$(6)[50] 'ファイルサーチ条件集荷
	Private strWhereSiji$(6)[50] 'ファイルサーチ条件指示
	Private strWhereKeppin$(6)[50] 'ファイルサーチ条件欠品
	Private strCheckNo$	'重複チェックNo
	Private iSrchCnt&	'集荷'
	Private iSrchCnt2&	'指示'
	Private iSrchCnt3&	'欠品'
	Private iWhereCnt&	'ファイル検索数'
	Private iWhereCnt2&	'ファイル検索数'
	Private iWhereCnt3&	'ファイル検索数'
	Private check%

	WHILE strSyoriHensu$ = "2000"
		Cls

		'--固定部分
		'タイトル表示
		CALL SetTitle(SyukaMenu.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)

		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 5, "品番:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 7, "包装:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 9, "収容数:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 11, "組付区:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 13, "整理No:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		If SIJISK.Cnt& > 0 Then
			SIText.Print( 1, 15, "指示書:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 15, ZeroUme$(SIJISK.Cnt&,3) + "枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		ELSE
			SIText.Print( 1, 15, "指示書:000枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		ENDIF

		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "指示書作成          ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "             M2:戻る", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'入力制御
		strInKey$ = M2.KEY


		'入力待ち(M1 or M2 or QR)
		W$ = FunInpGet$(strInKey$, 1, "Q:")

		If strQR$ <> "" Then
			'集荷実績のレコード数チェック
			If SYJISK.Cnt& < 10000 Then	'10000件
				'かんばんかチェック
				If  Len(strQR$) = 119 OR Len(strQR$) = 124 Then
					'先頭4桁がJAMAか判定
					If Mid$(strQR$,1,4) = "JAMA" Then

						'eかんばんか社内かんばんか'
						If  Len(strQR$) = 119 THEN
							'eかんばん指示書分割'
							SijiSplit(strQR$)

							'重複条件(集荷実績)'
							strWhereSyuka$(0) = .Equal+Chr$(5) + g.SIJISK.1$		'デンソー品番
							strWhereSyuka$(1) = .Equal+Chr$(6) + g.SIJISK.2$		'包装
							strWhereSyuka$(2) = .Equal+Chr$(8) + g.SIJISK.5$		'整理番号
							strWhereSyuka$(3) = .Equal+Chr$(10) + g.SIJISK.6$		'納入日
							strWhereSyuka$(4) = .Equal+Chr$(41) + "OK"					'照合結果
							iWhereCnt& = 5
							'重複条件(指示書実績)'
							strWhereSiji$(0) = .Equal+Chr$(1) + g.SIJISK.1$		'デンソー品番
							strWhereSiji$(1) = .Equal+Chr$(2) + g.SIJISK.2$		'包装
							strWhereSiji$(2) = .Equal+Chr$(5) + g.SIJISK.5$		'整理番号
							strWhereSiji$(3) = .Equal+Chr$(6) + g.SIJISK.6$		'納入日
							iWhereCnt2& = 4

						ELSE
							'社内かんばん指示書分割'
							SijiSplit(strQR$)

							'重複条件(集荷実績)'
							strWhereSyuka$(0) = .Equal+Chr$(13) + g.SIJISK.7$		'かんばん種類
							strWhereSyuka$(1) = .Equal+Chr$(16) + g.SIJISK.1$		'ﾃﾞﾝｿｰ品番
							strWhereSyuka$(2) = .Equal+Chr$(17) + g.SIJISK.2$		'包装
							strWhereSyuka$(3) = .Equal+Chr$(19) + g.SIJISK.4$		'組付区
							strWhereSyuka$(4) = .Equal+Chr$(21) + g.SIJISK.5$		'整理No
							strWhereSyuka$(5) = .Equal+Chr$(41) + "OK"					'照合結果
							iWhereCnt& = 6
							'重複条件(指示書実績)'
							strWhereSiji$(0) = .Equal+Chr$(7) + g.SIJISK.7$		'かんばん種類
							strWhereSiji$(1) = .Equal+Chr$(1) + g.SIJISK.1$		'ﾃﾞﾝｿｰ品番
							strWhereSiji$(2) = .Equal+Chr$(2) + g.SIJISK.2$		'包装
							strWhereSiji$(3) = .Equal+Chr$(4) + g.SIJISK.4$		'組付区
							strWhereSiji$(4) = .Equal+Chr$(5) + g.SIJISK.5$		'整理No
							iWhereCnt2& = 5

						endif
						'重複条件(欠品情報)'
						strWhereKeppin$(0) = .Equal+Chr$(3) + g.SIJISK.1$		'デンソー品番
						strWhereKeppin$(1) = .Equal+Chr$(4) + g.SIJISK.2$		'包装
						strWhereKeppin$(2) = .Equal+Chr$(7) + g.SIJISK.5$		'整理番号
						iWhereCnt3& = 3

						'ファイル検索
						iSrchCnt& = SYJISK.Srch&(.fcAndSrch, strWhereSyuka$, iWhereCnt&, 1, 0)
						iSrchCnt2& = SIJISK.Srch&(.fcAndSrch, strWhereSiji$, iWhereCnt2&, 1, 0)
						iSrchCnt3& = KEJISK.Srch&(.fcAndSrch, strWhereKeppin$, iWhereCnt3&, 1, 0)
						'集荷、指示書実績にデータ有り'
						If iSrchCnt& < 1 AND iSrchCnt2& < 1 Then
							'欠品実績にデータ有り'
							If iSrchCnt3& < 1  Then
								'指示書実績書き込み'
								SIJISK.Put(0)
								'---指示書作成完了----
								NextScreen.Set("2001")
							ELSE
								'----重複の場合はエラー
								Call NG.Beep
								SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
								iMsg.Text$(1) = "欠品集荷対象の"
								iMsg.Text$(2) = "かんばんです"
								If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
								Endif
							EndIF

						Else
							'----重複の場合はエラー
							Call NG.Beep
							SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
							iMsg.Text$(1) = "読取済みの"
							iMsg.Text$(2) = "かんばんです"
							If SIMsgBox.PopUp$(7, "重複読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
							Endif
						END IF
					ELSE
						'----かんばんでない場合はエラー
						Call NG.Beep
						SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
						iMsg.Text$(1) = "かんばん"
						iMsg.Text$(2) = "ではありません"
						If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
						Endif
					END IF
				ELSE
					'----かんばんでない場合はエラー
					Call NG.Beep
					SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
					iMsg.Text$(1) = "かんばん"
					iMsg.Text$(2) = "ではありません"
					If Len(SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY)) = 10 Then
					Endif
				Endif
			ELSE
				'---集荷実績が1万件以上の場合はエラー
				Call NG.Beep
				SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
				iMsg.Text$(1) = "実績データ保持"
				iMsg.Text$(2) = "最大件数到達。"
				iMsg.Text$(3) = "実績データを"
				iMsg.Text$(4) = "送信して下さい。"
				If SIMsgBox.PopUp$(7, "最大件数超過", iMsg.Text$(), 4, Lc.MSG.OKONLY) = M1.KEY Then
				Endif
			END IF
		ELSE
			SELECT CASE W$
				CASE M2.KEY	'戻る
					'---メニュー画面をセット
					NextScreen.Set("0000")

			END SELECT
		END IF

	 WEND
 End Sub


'*************************************************************************************************************************************************
'	[2001]指示書作成完了
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.CreateCompKanban

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	Private strWhereSyuka$(6)[50] 'ファイルサーチ条件集荷
	Private strWhereSiji$(6)[50] 'ファイルサーチ条件指示
	Private strWhereKeppin$(6)[50] 'ファイルサーチ条件欠品
	Private strCheckNo$	'重複チェックNo
	Private iSrchCnt&	'集荷'
	Private iSrchCnt2&	'指示'
	Private iSrchCnt3&	'欠品'
	Private iWhereCnt&	'ファイル検索数'
	Private iWhereCnt2&	'ファイル検索数'
	Private iWhereCnt3&	'ファイル検索数'
	Private check%

	WHILE strSyoriHensu$ = "2001"
		Cls

		'--固定部分
		'タイトル表示
		CALL SetTitle(SyukaMenu.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)

		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 5, "品番:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 7, "包装:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 9, "収容数:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 11, "組付区:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 13, "整理No:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		SIText.Print( 6, 5, g.SIJISK.1$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 6, 7, g.SIJISK.2$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 9, Trim$(g.SIJISK.3$), Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 11, g.SIJISK.4$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 13, g.SIJISK.5$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		SIText.Print( 1, 15, "指示書:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 15, ZeroUme$(SIJISK.Cnt&,3) + "枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)


		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "指示書作成完了!     ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "M1:次へ      M2:戻る", Lc.RAT.NORMAL, Lc.BLD.NORMAL)


		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'入力制御
		strInKey$ = M1.KEY + M2.KEY


		'入力待ち(M1 or M2 or QR)
		W$ = FunInpGet$(strInKey$, 1, "Q:")

		If strQR$ <> "" Then
			'かんばんかチェック
			If  Len(strQR$) = 119 OR Len(strQR$) = 124 Then
				'先頭4桁がJAMAか判定
				If Mid$(strQR$,1,4) = "JAMA" Then

					'eかんばんか社内かんばんか'
					If  Len(strQR$) = 119 THEN
						'eかんばん指示書分割'
						SijiSplit(strQR$)

						'重複条件(集荷実績)'
						strWhereSyuka$(0) = .Equal+Chr$(5) + g.SIJISK.1$		'デンソー品番
						strWhereSyuka$(1) = .Equal+Chr$(6) + g.SIJISK.2$		'包装
						strWhereSyuka$(2) = .Equal+Chr$(8) + g.SIJISK.5$		'整理番号
						strWhereSyuka$(3) = .Equal+Chr$(10) + g.SIJISK.6$		'納入日
						strWhereSyuka$(4) = .Equal+Chr$(41) + "OK"					'照合結果
						iWhereCnt& = 5
						'重複条件(指示書実績)'
						strWhereSiji$(0) = .Equal+Chr$(1) + g.SIJISK.1$		'デンソー品番
						strWhereSiji$(1) = .Equal+Chr$(2) + g.SIJISK.2$		'包装
						strWhereSiji$(2) = .Equal+Chr$(5) + g.SIJISK.5$		'整理番号
						strWhereSiji$(3) = .Equal+Chr$(6) + g.SIJISK.6$		'納入日
						iWhereCnt2& = 4
					ELSE
						'社内かんばん指示書分割'
						SijiSplit(strQR$)

						'重複条件(集荷実績)'
						strWhereSyuka$(0) = .Equal+Chr$(13) + g.SIJISK.7$		'かんばん種類
						strWhereSyuka$(1) = .Equal+Chr$(16) + g.SIJISK.1$		'ﾃﾞﾝｿｰ品番
						strWhereSyuka$(2) = .Equal+Chr$(17) + g.SIJISK.2$		'包装
						strWhereSyuka$(3) = .Equal+Chr$(19) + g.SIJISK.4$		'組付区
						strWhereSyuka$(4) = .Equal+Chr$(21) + g.SIJISK.5$		'整理No
						strWhereSyuka$(5) = .Equal+Chr$(41) + "OK"					'照合結果
						iWhereCnt& = 6
						'重複条件(指示書実績)'
						strWhereSiji$(0) = .Equal+Chr$(7) + g.SIJISK.7$		'かんばん種類
						strWhereSiji$(1) = .Equal+Chr$(1) + g.SIJISK.1$		'ﾃﾞﾝｿｰ品番
						strWhereSiji$(2) = .Equal+Chr$(2) + g.SIJISK.2$		'包装
						strWhereSiji$(3) = .Equal+Chr$(4) + g.SIJISK.4$		'組付区
						strWhereSiji$(4) = .Equal+Chr$(5) + g.SIJISK.5$		'整理No
						iWhereCnt2& = 5
					endif

					'重複条件(欠品情報)'
					strWhereKeppin$(0) = .Equal+Chr$(3) + g.SIJISK.1$		'デンソー品番
					strWhereKeppin$(1) = .Equal+Chr$(4) + g.SIJISK.2$		'包装
					strWhereKeppin$(2) = .Equal+Chr$(7) + g.SIJISK.5$		'整理番号
					iWhereCnt3& = 3
					'ファイル検索
					iSrchCnt& = SYJISK.Srch&(.fcAndSrch, strWhereSyuka$, iWhereCnt&, 1, 0)
					iSrchCnt2& = SIJISK.Srch&(.fcAndSrch, strWhereSiji$, iWhereCnt2&, 1, 0)
					iSrchCnt3& = KEJISK.Srch&(.fcAndSrch, strWhereKeppin$, iWhereCnt3&, 1, 0)
					If iSrchCnt& < 1 AND iSrchCnt2& < 1 Then
						'欠品実績にデータ有り'
							If iSrchCnt3& < 1  Then
								'指示書実績書き込み'
								SIJISK.Put(0)
								'---指示書作成完了----
								NextScreen.Set("2001")
							ELSE
								'----重複の場合はエラー
								Call NG.Beep
								SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
								iMsg.Text$(1) = "欠品集荷対象の"
								iMsg.Text$(2) = "かんばんです"
								If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
								Endif
							EndIF
					Else
						'----重複の場合はエラー
						Call NG.Beep
						SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
						iMsg.Text$(1) = "読取済みの"
						iMsg.Text$(2) = "かんばんです"
						If SIMsgBox.PopUp$(7, "重複読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
						Endif
					END IF
				ELSE
					'----かんばんでない場合はエラー
					Call NG.Beep
					SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
					iMsg.Text$(1) = "かんばん"
					iMsg.Text$(2) = "ではありません"
					If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
					Endif
				END IF
			ELSE
				'----かんばんでない場合はエラー
				Call NG.Beep
				SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
				iMsg.Text$(1) = "かんばん"
				iMsg.Text$(2) = "ではありません"
				If Len(SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY)) = 10 Then
				Endif
			Endif

		ELSE
			SELECT CASE W$
				CASE M1.KEY
					'---かんばん読取(指示書実績有り)----
					NextScreen.Set("2015")
				CASE M2.KEY	'戻る
					'---メニュー画面をセット
					NextScreen.Set("0000")
			END SELECT
		END IF

	 WEND
 End Sub
'*************************************************************************************************************************************************
'	[2010]かんばん読取(指示書実績無し)
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.ReadKanban

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	Private strHinbanCount$	'未送信件数
	Private strWhere$(6)[50] 'ファイルサーチ条件
	Private strWhereKeppin$(6)[50] 'ファイルサーチ条件欠品
	Private strCheckNo$	'重複チェックNo
	Private iSrchCnt&
	Private iSrchCnt2&
	Private iWhereCnt&	'ファイル検索数'
	Private iWhereCnt2&	'ファイル検索数'

	WHILE strSyoriHensu$ = "2010"
		Cls

		'--固定部分
		'タイトル表示
		CALL SetTitle(SyukaMenu.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)

		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 5, "品番:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 7, "包装:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 9, "収容数:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 11, "組付区:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 13, "整理No:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 15, "指示書:000枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)


		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "かんばん読取         ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "M1:欠品      M2:戻る", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'入力制御
		strInKey$ = M1.KEY + M2.KEY

		'入力待ち(M1 or M2 or QR)
		W$ = FunInpGet$(strInKey$, 1, "Q:")

			If strQR$ <> "" Then
				'かんばんかチェック
				If  Len(strQR$) = 119 OR Len(strQR$) = 124 Then
					'先頭4桁がJAMAか判定
					If Mid$(strQR$,1,4) = "JAMA" Then

						'eかんばんか社内かんばんか'
						If  Len(strQR$) = 119 THEN
							'eかんばん集荷実績'
							EkanbanSplit(strQR$)

							'重複条件(集荷実績)'
							strWhere$(0) = .Equal+Chr$(5) + g.SYJISK.5$		'デンソー品番
							strWhere$(1) = .Equal+Chr$(6) + g.SYJISK.6$		'包装
							strWhere$(2) = .Equal+Chr$(8) + g.SYJISK.8$		'整理番号
							strWhere$(3) = .Equal+Chr$(10) + g.SYJISK.10$		'納入日
							strWhere$(4) = .Equal+Chr$(41) + "OK"					'照合結果
							iWhereCnt& = 5
							'重複条件(欠品実績)'
							strWhereKeppin$(0) = .Equal+Chr$(3) + g.SYJISK.5$		'デンソー品番
							strWhereKeppin$(1) = .Equal+Chr$(4) + g.SYJISK.6$		'包装
							strWhereKeppin$(2) = .Equal+Chr$(7) + g.SYJISK.8$		'整理番号
							iWhereCnt2& = 3
							'変数セット'
							g.strHinban$ = g.SYJISK.5$
							g.strHouso$ = g.SYJISK.6$
							g.strSyuyo$ = g.SYJISK.7$
							g.strKumitsukeku$ = ""
							g.strSeiriNo$ = g.SYJISK.8$
						ELSE
							'社内かんばん集荷実績'
							kanbanSplit(strQR$)
							'重複条件(集荷実績)'
							strWhere$(0) = .Equal+Chr$(13) + g.SYJISK.13$		'かんばん種類
							strWhere$(1) = .Equal+Chr$(16) + g.SYJISK.16$		'ﾃﾞﾝｿｰ品番
							strWhere$(2) = .Equal+Chr$(17) + g.SYJISK.17$		'包装
							strWhere$(3) = .Equal+Chr$(19) + g.SYJISK.19$		'組付区
							strWhere$(4) = .Equal+Chr$(21) + g.SYJISK.21$		'整理No
							strWhere$(5) = .Equal+Chr$(41) + "OK"					'照合結果
							iWhereCnt& = 6
							'重複条件(欠品実績)'
							strWhereKeppin$(0) = .Equal+Chr$(3) + g.SYJISK.16$		'デンソー品番
							strWhereKeppin$(1) = .Equal+Chr$(4) + g.SYJISK.17$		'包装
							strWhereKeppin$(2) = .Equal+Chr$(7) + g.SYJISK.21$		'整理番号
							iWhereCnt2& = 3
							'変数セット'
							g.strHinban$ = g.SYJISK.16$
							g.strHouso$ = g.SYJISK.17$
							g.strSyuyo$ = g.SYJISK.18$
							g.strKumitsukeku$ = g.SYJISK.19$
							g.strSeiriNo$ = g.SYJISK.21$
						endif

						'集荷実績ファイル検索
						iSrchCnt& = SYJISK.Srch&(.fcAndSrch, strWhere$, iWhereCnt&, 1, 0)
						iSrchCnt2& = KEJISK.Srch&(.fcAndSrch, strWhereKeppin$, iWhereCnt2&, 1, 0)
						If iSrchCnt& < 1 Then
							'欠品実績にデータ有り'
							If iSrchCnt2& < 1  Then
								'遷移番号'
								g.strStageNo2$ = "2010"
								'指示書実績なし'
								g.intFlg& = 1
								'---トレース読取----
								NextScreen.Set("2020")
							ELSE
								'----重複の場合はエラー
								Call NG.Beep
								SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
								iMsg.Text$(1) = "欠品集荷対象の"
								iMsg.Text$(2) = "かんばんです"
								If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
								Endif
							EndIF

						Else
							'----重複の場合はエラー
							Call NG.Beep
							SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
							iMsg.Text$(1) = "読取済みの"
							iMsg.Text$(2) = "かんばんです"
							If SIMsgBox.PopUp$(7, "重複読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
							Endif
						END IF
					ELSE
						'----かんばんでない場合はエラー
						Call NG.Beep
						SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
						iMsg.Text$(1) = "かんばん"
						iMsg.Text$(2) = "ではありません"
						If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
						Endif
					END IF
				ELSE
					'----かんばんでない場合はエラー
					Call NG.Beep
					SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
					iMsg.Text$(1) = "かんばん"
					iMsg.Text$(2) = "ではありません"
					If Len(SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY)) = 10 Then
					Endif
				Endif

			ELSE
				SELECT CASE W$
					CASE M1.KEY
						'----------------操作確認popup----------------'
						SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
						Call NG.Beep
						SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Green, Lc.Col.Black, Lc.Col.Lime, Lc.Col.Black, Lc.Col.20Gray)
						iMsg.Text$(1) = "欠品登録します。"
						iMsg.Text$(2) = "よろしいですか？"
						IF SIMsgBox.PopUp$(7, "操作確認", iMsg.Text$(), 2, Lc.MSG.YESNO) = M1.KEY  Then
							'---欠品かんばん読取画面(指示書実績無し)----
							NextScreen.Set("2030")
						END IF

					CASE M2.KEY	'戻る
						'---メニュー
						NextScreen.Set("0000")
				END SELECT
			END IF

	 WEND
 End Sub

'*************************************************************************************************************************************************
'	[2015]かんばん読取(指示書実績有り)
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.ReadKanbanSIJI

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	DIM intRet%
	DIM flgLoop%
	DIM pPopRET$
	Private strHinbanCount$	'未送信件数
	Private strWhere$(5)[50] 'ファイルサーチ条件
	Private strCheckNo$	'重複チェックNo
	Private iSrchCnt&
	Private strHouso$'包装'
	Private strHinban$'品番'
	Private strSuryo$'数量'

	WHILE strSyoriHensu$ = "2015"
		Cls

		'--固定部分
		'タイトル表示
		CALL SetTitle(SyukaMenu.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)

		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 5, "品番:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 7, "包装:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 9, "収容数:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 11, "組付区:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 13, "整理No:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 15, "指示書:000枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'指示書実績取得'
		if g.intRecSIJI& > 1 Then
			SIJISK.Get(g.intRecSIJI&)
		ELSE
			g.intRecSIJI& = 1
			SIJISK.Get(g.intRecSIJI&)
		endif

		SIText.Print( 6, 5, g.SIJISK.1$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 6, 7, g.SIJISK.2$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 9, Trim$(g.SIJISK.3$), Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 11, g.SIJISK.4$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 13, g.SIJISK.5$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		SIText.Print( 1, 15, "指示書:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 15, ZeroUme$(SIJISK.Cnt&,3) + "枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "かんばん読取         ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "F1:指示一覧         ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "M1:欠品      M2:戻る", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'入力制御
		strInKey$ = M1.KEY + M2.KEY + F1.KEY + SFF4.KEY

		'入力待ち(M1 or M2 or QR or F1 or SFF4)
		W$ = FunInpGet$(strInKey$, 1, "Q:")

			If strQR$ <> "" Then
				'かんばんかチェック
				If  Len(strQR$) = 119 OR Len(strQR$) = 124 Then
					'先頭4桁がJAMAか判定
					If Mid$(strQR$,1,4) = "JAMA" Then

						'eかんばんか社内かんばんか'
						If  Len(strQR$) = 119 THEN
							'eかんばん集荷実績'
							EkanbanSplit(strQR$)
							strHinban$ = g.SYJISK.5$
							strHouso$ = g.SYJISK.6$
							strSuryo$ = g.SYJISK.7$
						ELSE
							'社内かんばん集荷実績'
							kanbanSplit(strQR$)
							strHinban$ = g.SYJISK.16$
							strHouso$ = g.SYJISK.17$
							strSuryo$ = g.SYJISK.18$
						endif
						'フラグセット'
						flgLoop% = Lc.True
						'品番チェック'
						If strHinban$ = g.SIJISK.1$ Then
							'包装チェック'
							If strHouso$ = g.SIJISK.2$ Then
								'数量チェック'
								If VAL(strSuryo$) = VAL(g.SIJISK.3$) Then
									'遷移番号'
									g.strStageNo2$ = "2015"
									'2021/05/12修正'
									g.intFlg& = 0
									'---トレースカード読取画面----
									NextScreen.Set("2020")
								Else
									Call NG.Beep
									SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
									iMsg.Text$(1) = "正：" + g.SIJISK.3$
									iMsg.Text$(2) = "誤：" + strSuryo$
									WHILE flgLoop% = Lc.True
										intRet% = Lc.True
										pPopRET$ = SIMsgBox.PopUp$(7, "数量エラー", iMsg.Text$(), 2, Lc.MSG.QRREAD)
										IF LEN(strQR$) = 10 THEN
											flgLoop% = Lc.False
										END IF
									WEND
								ENDIF
							Else
								Call NG.Beep
								SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
								iMsg.Text$(1) = "正：" + g.SIJISK.2$
								iMsg.Text$(2) = "誤：" + strHouso$
								WHILE flgLoop% = Lc.True
									intRet% = Lc.True
									pPopRET$ = SIMsgBox.PopUp$(7, "包装エラー", iMsg.Text$(), 2, Lc.MSG.QRREAD)
									IF LEN(strQR$) = 10 THEN
										flgLoop% = Lc.False
									END IF
								WEND
							ENDIF
						Else
							'品番エラー
							Call NG.Beep
							SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
							iMsg.Text$(1) = "正：" + g.SIJISK.1$
							iMsg.Text$(2) = "誤：" + strHinban$
							WHILE flgLoop% = Lc.True
								intRet% = Lc.True
								pPopRET$ = SIMsgBox.PopUp$(7, "品番エラー", iMsg.Text$(), 2, Lc.MSG.QRREAD)
								IF LEN(strQR$) = 10 THEN
									flgLoop% = Lc.False
								END IF
							WEND
						END IF

					ELSE
						'----かんばんでない場合はエラー
						Call NG.Beep
						SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
						iMsg.Text$(1) = "かんばん"
						iMsg.Text$(2) = "ではありません"
						If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
						Endif
					END IF
				ELSE
					'----かんばんでない場合はエラー
					Call NG.Beep
					SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
					iMsg.Text$(1) = "かんばん"
					iMsg.Text$(2) = "ではありません"
					If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
					Endif
				Endif

			ELSE
				SELECT CASE W$
					CASE M1.KEY
						'----------------操作確認popup----------------'
						SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
						Call NG.Beep
						SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Green, Lc.Col.Black, Lc.Col.Lime, Lc.Col.Black, Lc.Col.20Gray)
						iMsg.Text$(1) = "欠品登録します。"
						iMsg.Text$(2) = "よろしいですか？"
						IF SIMsgBox.PopUp$(7, "操作確認", iMsg.Text$(), 2, Lc.MSG.YESNO) = M1.KEY  Then
							'---欠品かんばん読取画面(指示書実績有り)----
							NextScreen.Set("2035")
						END IF
					CASE M2.KEY	'戻る
						'---かんばん指示書作成画面
						NextScreen.Set("2000")
					CASE SFF4.KEY
						'----------------操作確認popup----------------'
						SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
						Call NG.Beep
						SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Green, Lc.Col.Black, Lc.Col.Lime, Lc.Col.Black, Lc.Col.20Gray)
						iMsg.Text$(1) = "次の指示に移り"
						iMsg.Text$(2) = "ます。"
						iMsg.Text$(3) = "よろしいですか？"
						IF SIMsgBox.PopUp$(7, "操作確認", iMsg.Text$(), 3, Lc.MSG.YESNO) = M1.KEY Then

							IF SIJISK.Cnt& > g.intRecSIJI& THEN
								'次品番あり'
								g.intRecSIJI& = g.intRecSIJI& + 1
							ELSE
								'次品番なし'
								g.intRecSIJI& = 1
							endif
							'---かんばん読取画面(指示書実績有り)----
							NextScreen.Set("2015")
						END IF
					CASE F1.KEY	'戻る
						'---指示一覧
						NextScreen.Set("2016")
				END SELECT
			END IF

	 WEND
 End Sub

'*************************************************************************************************************************************************
'	[2016]指示一覧
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.SijiList

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	DIM strListData$(8)[25]
	DIM intListCnt%
	DIM flgLoop%
	Private intMax%,intToo% '配列要素数、余り
	Private intNext%
	Private intNumber%'実績行番号'
	Private strDeleteNum$'削除行'

	'指示実績件数取得'
	intMax% = SIJISK.Cnt&

	'ページ数確認
	g.intMaxP& = intMax% / 7
	intToo% = intMax% MOD 7

	'ページ数確定'
	IF intMax% >= 7 Then
		IF intToo% > 0 Then
			g.intMaxP& = g.intMaxP& + 1
		ENDIF
	Else
		g.intMaxP& = g.intMaxP& + 1
	ENDIF


	'画面処理
	WHILE strSyoriHensu$ = "2016"

		Cls

		SIList.Cursor& = 1		'配列内のカーソルの行
		SIList.TopPos& = 1		'スクリーンのTOP行

		'リストデータ初期化'
		For intNext% = 1 To 7
			strListData$(intNext%) = ""
		Next intNext%

		'データセット'
		intNext% = 1
		flgLoop% = Lc.True
		WHILE flgLoop% = Lc.True
			IF intNext% > 7 OR g.intPage& * 7 + intNext% > SIJISK.Cnt& Then
				flgLoop% = Lc.False

			Else
				'データ取得'
				SIJISK.Get(intNext%)
				strListData$(intNext%) = STR$(intNext%) + ":" + g.SIJISK.1$ + "  " + g.SIJISK.5$
				'ﾒﾆｭｰ項目数
				intListCnt% = intNext%
			EndIF
			intNext% = intNext% + 1
		WEND

		'--固定部分
		'タイトル表示
		CALL SetTitle(SyukaMenu.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 3, "実績:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 6, 3, ZeroUme$(intMax%,3) + "件", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		if intToo% = 0 then
			SIText.Print( 12, 3, "<" + ZeroUme$(g.intPage& + 1,3) + "/" + ZeroUme$(g.intMaxP&,3) + ">", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		else
			SIText.Print( 12, 3, "<" + ZeroUme$(g.intPage& + 1,3) + "/" + ZeroUme$(g.intMaxP&,3) + ">", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		END IF
		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "読取かんばん一覧    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)

		'1ページのみ'
		IF g.intPage& + 1 = 1 Then
			SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'リスト表示 & 入力待ち
			strInKey$ = M1.KEY + M2.KEY
		ENDIF
		'2ページ目で次頁有り'
		IF g.intMaxP& > g.intPage& + 1 Then
			SIText.Print( 1,22, "←F7:前頁  F8:次頁→", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'リスト表示 & 入力待ち
			strInKey$ = M1.KEY + M2.KEY + F7.KEY + F8.KEY
		ENDIF
		'1ページ目かつ次頁有り'
		IF g.intPage& + 1 = 1 AND g.intMaxP& > g.intPage& + 1 Then
			SIText.Print( 1,22, "           F8:次頁→", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'リスト表示 & 入力待ち
			strInKey$ = M1.KEY + M2.KEY + F8.KEY
		ENDIF
		'最大ページ時'
		IF g.intPage& + 1 = g.intMaxP& AND g.intMaxP& <> 1 Then
			SIText.Print( 1,22, "←F7:前頁           ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'リスト表示 & 入力待ち
			strInKey$ = M1.KEY + M2.KEY  + F7.KEY
		ENDIF

		SIText.Print( 1,24, "             M2:戻る", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIFont.Reset

		W$ = SIList$( 1, 6, 7, 20, strListData$, intListCnt%, strInKey$)
		SELECT W$
			CASE M2.KEY	'戻る
				'---かんばん読取画面(指示書実績有り)----
				NextScreen.Set("2015")

			CASE F7.KEY	'前頁
				g.intPage& = g.intPage& - 1
			CASE F8.KEY	'次頁
				g.intPage& = g.intPage& + 1
		END SELECT
	WEND
 End Sub




'*************************************************************************************************************************************************
'	[2020]トレース読取
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.ReadTraceCard

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	DIM intRet%
	DIM flgLoop%
	DIM pPopRET$

	Private strWhere$(6)[50] 'ファイルサーチ条件
	Private strCheckNo$	'重複チェックNo
	Private iSrchCnt&
	Private strHouso$'包装'
	Private strHinban$'品番'
	Private strSuryo$'数量'
	Private strKanbanSyurui$'かんばん種類'
	Private strRoke$'製品ロケーション'
	Private strTraceID$'トレースID'
	Private strHakkouTime$'発行年月日時'

	WHILE strSyoriHensu$ = "2020"
		Cls

		'--固定部分
		'タイトル表示
		CALL SetTitle(SyukaMenu.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)

		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 5, "品番:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 7, "包装:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 9, "収容数:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 11, "組付区:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 13, "整理No:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 15, "指示書:000枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'指示実績あるかないか'
		if g.intFlg& = 1 THEN
			SIText.Print( 6, 5, g.strHinban$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 6, 7, g.strHouso$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 9, Trim$(g.strSyuyo$), Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 11, g.strKumitsukeku$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 13, g.strSeiriNo$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'SIText.Print( 1, 15, "指示書:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'SIText.Print( 8, 15, ZeroUme$(SIJISK.Cnt&,3) + "枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		Else
			'指示書実績取得'
			if g.intRecSIJI& > 1 Then
				SIJISK.Get(g.intRecSIJI&)
			ELSE
				g.intRecSIJI& = 1
				SIJISK.Get(g.intRecSIJI&)
			endif
			SIText.Print( 6, 5, g.SIJISK.1$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 6, 7, g.SIJISK.2$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 9, Trim$(g.SIJISK.3$), Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 11, g.SIJISK.4$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 13, g.SIJISK.5$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 1, 15, "指示書:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 15, ZeroUme$(SIJISK.Cnt&,3) + "枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'変数セット'
			g.strHinban$ = g.SIJISK.1$
			g.strHouso$ = g.SIJISK.2$
			g.strSyuyo$ = g.SIJISK.3$
			g.strKumitsukeku$ = g.SIJISK.4$
			g.strSeiriNo$ = g.SIJISK.5$
		END IF


		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "トレースカード読取  ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "             M2:戻る", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'入力制御
		strInKey$ = M2.KEY

		'入力待ち(M2 or QR)
		W$ = FunInpGet$(strInKey$, 1, "Q:")

		If strQR$ <> "" Then
			strKanbanSyurui$ = SIDensoQR.Decode$(strQR$,"100",2,1)
			'strRoke$ = SIDensoQR.Decode$(strQR$,"151",5,1)
			strTraceID$ = SIDensoQR.Decode$(strQR$,"543",8,1)
			strHakkouTime$ = SIDensoQR.Decode$(strQR$,"561",14,1)

			'トレースカードがチェック
			If  Mid$(strQR$,1,4) = "JAMA" AND Mid$(strQR$,5,6) = "506002"  AND strKanbanSyurui$ = "00" AND strTraceID$ <> "" AND strHakkouTime$ <> "" Then
				'トレースカード取得'
				TraceCardSplit(strQR$)
				'重複条件(集荷実績)'
				strWhere$(0) = .Equal+Chr$(24) + g.SYJISK.24$		'デンソー品番
				strWhere$(1) = .Equal+Chr$(25) + g.SYJISK.25$		'包装区分
				strWhere$(2) = .Equal+Chr$(30) + g.SYJISK.30$		'整理No
				strWhere$(3) = .Equal+Chr$(31) + g.SYJISK.31$		'トレースID
				strWhere$(4) = .Equal+Chr$(32) + g.SYJISK.32$		'発行年月日
				strWhere$(5) = .Equal+Chr$(41) + "OK"		'照合結果
				'集荷実績ファイル検索
				iSrchCnt& = SYJISK.Srch&(.fcAndSrch, strWhere$, 6, 1, 0)
				'重複チェック
				If iSrchCnt& < 1 Then
				strHinban$ = g.SYJISK.24$
				strHouso$ = g.SYJISK.25$
				strSuryo$ = g.SYJISK.26$

				'フラグセット'
					flgLoop% = Lc.True
					'品番チェック'
					If strHinban$ = g.strHinban$ Then
						'包装チェック'
						If strHouso$ = g.strHouso$ Then
							'数量チェック'
							'2021/05/10修正前 Trim$(strSuryo$) = Trim$(g.strSyuyo$) Replace$(strSuryo$," ","0") = Replace$(g.strSyuyo$," ","0")
							If VAL(strSuryo$) = VAL(g.strSyuyo$) Then
								'集荷実績OK書き込み'
								SyukaWrite("0","OK","")
								'---集荷完了画面
								NextScreen.Set("2050")
							Else
								'集荷実績NG書き込み'
								SyukaWrite("0","NG","2")
								Call NG.Beep
								SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
								iMsg.Text$(1) = "正：" + g.strSyuyo$
								iMsg.Text$(2) = "誤：" + strSuryo$
								WHILE flgLoop% = Lc.True
									intRet% = Lc.True
									pPopRET$ = SIMsgBox.PopUp$(7, "数量エラー", iMsg.Text$(), 2, Lc.MSG.QRREAD)
									IF LEN(strQR$) = 10 THEN
										flgLoop% = Lc.False
									END IF
								WEND
							ENDIF
						Else
							'集荷実績NG書き込み'
							SyukaWrite("0","NG","1")
							Call NG.Beep
							SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
							iMsg.Text$(1) = "正：" + g.strHouso$
							iMsg.Text$(2) = "誤：" + strHouso$
							WHILE flgLoop% = Lc.True
								intRet% = Lc.True
								pPopRET$ = SIMsgBox.PopUp$(7, "包装エラー", iMsg.Text$(), 2, Lc.MSG.QRREAD)
								IF LEN(strQR$) = 10 THEN
									flgLoop% = Lc.False
								END IF
							WEND
						ENDIF
					Else
						'集荷実績NG書き込み'
						SyukaWrite("0","NG","0")
						'品番エラー
						Call NG.Beep
						SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
						iMsg.Text$(1) = "正：" + g.strHinban$
						iMsg.Text$(2) = "誤：" + strHinban$
						WHILE flgLoop% = Lc.True
							intRet% = Lc.True
							pPopRET$ = SIMsgBox.PopUp$(7, "品番エラー", iMsg.Text$(), 2, Lc.MSG.QRREAD)
							IF LEN(strQR$) = 10 THEN
								flgLoop% = Lc.False
							END IF
						WEND
					END IF

				ELSE
					'----トレースカードでない場合はエラー
					Call NG.Beep
					SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
					iMsg.Text$(1) = "読取済みの"
					iMsg.Text$(2) = "ﾄﾚｰｽｶｰﾄﾞです"
					If SIMsgBox.PopUp$(7, "重複読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
					Endif
				END IF
			ELSE
				'----トレースカードでない場合はエラー
				Call NG.Beep
				SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
				iMsg.Text$(1) = "トレースカード"
				iMsg.Text$(2) = "ではありません"
				If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
				Endif
			Endif

		ELSE
			SELECT CASE W$
				CASE M2.KEY	'戻る
					'---かんばん指示書作成画面
					NextScreen.Set(g.strStageNo2$)
			END SELECT
		END IF

	 WEND
 End Sub



'*************************************************************************************************************************************************
'	[2030]欠品かんばん読取(指示書実績無し)
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.KeppinReadKanban

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	Private strHinbanCount$	'未送信件数
	Private strWhere$(6)[50] 'ファイルサーチ条件
	Private strWhereKeppin$(6)[50] 'ファイルサーチ条件欠品
	Private strCheckNo$	'重複チェックNo
	Private iSrchCnt&
	Private iSrchCnt2&
	Private iWhereCnt&	'ファイル検索数'
	Private iWhereCnt2&	'ファイル検索数'

	WHILE strSyoriHensu$ = "2030"
		Cls

		'--固定部分
		'タイトル表示
		CALL SetTitle(SyukaMenu.NAME$, Lc.Col.Black, Lc.Col.Yellow, 1, 1)

		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 5, "品番:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 7, "包装:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 9, "収容数:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 11, "組付区:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 13, "整理No:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 15, "指示書:000枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)


		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "欠品かんばん読取    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "             M2:戻る", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'入力制御
		strInKey$ = M2.KEY

		'入力待ち(M1 or M2 or QR)
		W$ = FunInpGet$(strInKey$, 1, "Q:")

			If strQR$ <> "" Then
				'かんばんかチェック
				If  Len(strQR$) = 119 OR Len(strQR$) = 124 Then
					'先頭4桁がJAMAか判定
					If Mid$(strQR$,1,4) = "JAMA" Then

						'eかんばんか社内かんばんか'
						If  Len(strQR$) = 119 THEN
							'eかんばん集荷実績'
							EkanbanSplit(strQR$)

							'重複条件(集荷実績)'
							strWhere$(0) = .Equal+Chr$(5) + g.SYJISK.5$		'デンソー品番
							strWhere$(1) = .Equal+Chr$(6) + g.SYJISK.6$		'包装
							strWhere$(2) = .Equal+Chr$(8) + g.SYJISK.8$		'整理番号
							strWhere$(3) = .Equal+Chr$(10) + g.SYJISK.10$		'納入日
							strWhere$(4) = .Equal+Chr$(41) + "OK"					'照合結果
							iWhereCnt& = 5
							'重複条件(欠品実績)'
							strWhereKeppin$(0) = .Equal+Chr$(3) + g.SYJISK.5$		'デンソー品番
							strWhereKeppin$(1) = .Equal+Chr$(4) + g.SYJISK.6$		'包装
							strWhereKeppin$(2) = .Equal+Chr$(7) + g.SYJISK.8$		'整理番号
							iWhereCnt2& = 3
							'変数セット'
							g.strHinban$ = g.SYJISK.5$
							g.strHouso$ = g.SYJISK.6$
							g.strSyuyo$ = g.SYJISK.7$
							g.strKumitsukeku$ = ""
							g.strSeiriNo$ = g.SYJISK.8$
						ELSE
							'社内かんばん集荷実績'
							kanbanSplit(strQR$)
							'重複条件(集荷実績)'
							strWhere$(0) = .Equal+Chr$(13) + g.SYJISK.13$		'かんばん種類
							strWhere$(1) = .Equal+Chr$(16) + g.SYJISK.16$		'ﾃﾞﾝｿｰ品番
							strWhere$(2) = .Equal+Chr$(17) + g.SYJISK.17$		'包装
							strWhere$(3) = .Equal+Chr$(19) + g.SYJISK.19$		'組付区
							strWhere$(4) = .Equal+Chr$(21) + g.SYJISK.21$		'整理No
							strWhere$(5) = .Equal+Chr$(41) + "OK"					'照合結果
							iWhereCnt& = 6
							'重複条件(欠品実績)'
							strWhereKeppin$(0) = .Equal+Chr$(3) + g.SYJISK.16$		'デンソー品番
							strWhereKeppin$(1) = .Equal+Chr$(4) + g.SYJISK.17$		'包装
							strWhereKeppin$(2) = .Equal+Chr$(7) + g.SYJISK.21$		'整理番号
							iWhereCnt2& = 3
							'変数セット'
							g.strHinban$ = g.SYJISK.16$
							g.strHouso$ = g.SYJISK.17$
							g.strSyuyo$ = g.SYJISK.18$
							g.strKumitsukeku$ = g.SYJISK.19$
							g.strSeiriNo$ = g.SYJISK.21$
						endif

						'集荷実績ファイル検索
						iSrchCnt& = SYJISK.Srch&(.fcAndSrch, strWhere$, iWhereCnt&, 1, 0)
						iSrchCnt2& = KEJISK.Srch&(.fcAndSrch, strWhereKeppin$, iWhereCnt2&, 1, 0)
						If iSrchCnt& < 1 Then
							'欠品実績にデータ有り'
							If iSrchCnt2& < 1  Then
								g.strStageNo$ = "2030"
								g.intFlg& = 1
								'-----けんつば読取----
								NextScreen.Set("2040")
							ELSE
								'----重複の場合はエラー
								Call NG.Beep
								SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
								iMsg.Text$(1) = "欠品集荷対象の"
								iMsg.Text$(2) = "かんばんです"
								If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
								Endif
							EndIF

						Else
							'----重複の場合はエラー
							Call NG.Beep
							SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
							iMsg.Text$(1) = "読取済みの"
							iMsg.Text$(2) = "かんばんです"
							If SIMsgBox.PopUp$(7, "重複読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
							Endif
						END IF
					ELSE
						'----かんばんでない場合はエラー
						Call NG.Beep
						SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
						iMsg.Text$(1) = "かんばん"
						iMsg.Text$(2) = "ではありません"
						If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
						Endif
					END IF
				ELSE
					'----かんばんでない場合はエラー
					Call NG.Beep
					SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
					iMsg.Text$(1) = "かんばん"
					iMsg.Text$(2) = "ではありません"
					If Len(SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY)) = 10 Then
					Endif
				Endif

			ELSE
				SELECT CASE W$

					CASE M2.KEY	'戻る
						'---かんばん読取(指示実績なし)
						NextScreen.Set("2010")
				END SELECT
			END IF

	 WEND
 End Sub

'*************************************************************************************************************************************************
'	[2035]欠品かんばん読取(指示書実績有り)
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.KeppinReadKanbanSIJI

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	DIM intRet%
	DIM flgLoop%
	DIM pPopRET$
	Private strHinbanCount$	'未送信件数
	Private strWhere$(5)[50] 'ファイルサーチ条件
	Private strCheckNo$	'重複チェックNo
	Private iSrchCnt&
	Private strHouso$'包装'
	Private strHinban$'品番'
	Private strSuryo$'数量'

	WHILE strSyoriHensu$ = "2035"
		Cls

		'--固定部分
		'タイトル表示
		CALL SetTitle(SyukaMenu.NAME$, Lc.Col.Black, Lc.Col.Yellow, 1, 1)

		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 5, "品番:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 7, "包装:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 9, "収容数:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 11, "組付区:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 13, "整理No:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 15, "指示書:000枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'指示書実績取得'
		if g.intRecSIJI& > 1 Then
			SIJISK.Get(g.intRecSIJI&)
		ELSE
			g.intRecSIJI& = 1
			SIJISK.Get(g.intRecSIJI&)
		endif
		SIText.Print( 6, 5, g.SIJISK.1$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 6, 7, g.SIJISK.2$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 9, Trim$(g.SIJISK.3$), Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 11, g.SIJISK.4$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 13, g.SIJISK.5$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		SIText.Print( 1, 15, "指示書:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 15, ZeroUme$(SIJISK.Cnt&,3) + "枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "欠品かんばん読取    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "             M2:戻る", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'入力制御
		strInKey$ = M2.KEY

		'入力待ち(M2 or QR)
		W$ = FunInpGet$(strInKey$, 1, "Q:")

			If strQR$ <> "" Then
				'かんばんかチェック
				If  Len(strQR$) = 119 OR Len(strQR$) = 124 Then
					'先頭4桁がJAMAか判定
					If Mid$(strQR$,1,4) = "JAMA" Then

						'eかんばんか社内かんばんか'
						If  Len(strQR$) = 119 THEN
							'eかんばん集荷実績'
							EkanbanSplit(strQR$)
							strHinban$ = g.SYJISK.5$
							strHouso$ = g.SYJISK.6$
							strSuryo$ = g.SYJISK.7$
						ELSE
							'社内かんばん集荷実績'
							kanbanSplit(strQR$)
							strHinban$ = g.SYJISK.16$
							strHouso$ = g.SYJISK.17$
							strSuryo$ = g.SYJISK.18$
						endif
						'フラグセット'
						flgLoop% = Lc.True
						'品番チェック'
						If strHinban$ = g.SIJISK.1$ Then
							'包装チェック'
							If strHouso$ = g.SIJISK.2$ Then

								'数量チェック'
								'2021/05/10修正前 strSuryo$ = Trim$(g.SIJISK.3$)'
								If VAL(strSuryo$) = VAL(g.SIJISK.3$) Then
									g.strStageNo$ = "2035"
									'2021/05/12修正'
									g.intFlg& = 0
									'---けんつば読取画面----
									NextScreen.Set("2040")
								Else
									Call NG.Beep
									SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
									iMsg.Text$(1) = "正：" + g.SIJISK.3$
									iMsg.Text$(2) = "誤：" + strSuryo$
									WHILE flgLoop% = Lc.True
										intRet% = Lc.True
										pPopRET$ = SIMsgBox.PopUp$(7, "数量エラー", iMsg.Text$(), 2, Lc.MSG.QRREAD)
										IF LEN(strQR$) = 10 THEN
											flgLoop% = Lc.False
										END IF
									WEND
								ENDIF
							Else
								Call NG.Beep
								SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
								iMsg.Text$(1) = "正：" + g.SIJISK.2$
								iMsg.Text$(2) = "誤：" + strHouso$
								WHILE flgLoop% = Lc.True
									intRet% = Lc.True
									pPopRET$ = SIMsgBox.PopUp$(7, "包装エラー", iMsg.Text$(), 2, Lc.MSG.QRREAD)
									IF LEN(strQR$) = 10 THEN
										flgLoop% = Lc.False
									END IF
								WEND
							ENDIF
						Else
							'品番エラー
							Call NG.Beep
							SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
							iMsg.Text$(1) = "正：" + g.SIJISK.1$
							iMsg.Text$(2) = "誤：" + strHinban$
							WHILE flgLoop% = Lc.True
								intRet% = Lc.True
								pPopRET$ = SIMsgBox.PopUp$(7, "品番エラー", iMsg.Text$(), 2, Lc.MSG.QRREAD)
								IF LEN(strQR$) = 10 THEN
									flgLoop% = Lc.False
								END IF
							WEND
						END IF

					ELSE
						'----かんばんでない場合はエラー
						Call NG.Beep
						SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
						iMsg.Text$(1) = "かんばん"
						iMsg.Text$(2) = "ではありません"
						If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
						Endif
					END IF
				ELSE
					'----かんばんでない場合はエラー
					Call NG.Beep
					SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
					iMsg.Text$(1) = "かんばん"
					iMsg.Text$(2) = "ではありません"
					If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
					Endif
				Endif

			ELSE
				SELECT CASE W$

					CASE M2.KEY	'戻る
						'---かんばん指示書作成画面
						NextScreen.Set("2015")
				END SELECT
			END IF

	 WEND
 End Sub

'*************************************************************************************************************************************************
'	[2040]けんつば読取
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.ReadKentsuba

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	DIM intRet%
	DIM flgLoop%
	DIM pPopRET$

	Private strWhere$(6)[50] 'ファイルサーチ条件
	Private strCheckNo$	'重複チェックNo
	Private iSrchCnt&
	Private strHouso$'包装'
	Private strHinban$'品番'
	Private strSuryo$'数量'
	Private strKanbanSyurui$'かんばん種類'
	Private strTHinban$'得意先品番'
	Private strTHinbanS$'得意先品番識別'
	Private strID151$	'ID151'
	Private strID543$	'ID543'
	Private strID561$	'ID561'
	WHILE strSyoriHensu$ = "2040"
		Cls

		'--固定部分
		'タイトル表示
		CALL SetTitle(SyukaMenu.NAME$, Lc.Col.Black, Lc.Col.Yellow, 1, 1)

		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 5, "品番:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 7, "包装:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 9, "収容数:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 11, "組付区:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 13, "整理No:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 15, "指示書:000枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'指示実績あるかないか'
		if g.intFlg& = 1 THEN
			SIText.Print( 6, 5, g.strHinban$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 6, 7, g.strHouso$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 9, Trim$(g.strSyuyo$), Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 11, g.strKumitsukeku$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 13, g.strSeiriNo$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'SIText.Print( 1, 15, "指示書:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'SIText.Print( 8, 15, ZeroUme$(SIJISK.Cnt&,3) + "枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		Else
			'指示書実績取得'
			if g.intRecSIJI& > 1 Then
				SIJISK.Get(g.intRecSIJI&)
			ELSE
				g.intRecSIJI& = 1
				SIJISK.Get(g.intRecSIJI&)
			endif
			SIText.Print( 6, 5, g.SIJISK.1$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 6, 7, g.SIJISK.2$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 9, Trim$(g.SIJISK.3$), Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 11, g.SIJISK.4$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 13, g.SIJISK.5$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 1, 15, "指示書:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 15, ZeroUme$(SIJISK.Cnt&,3) + "枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'変数セット'
			g.strHinban$ = g.SIJISK.1$
			g.strHouso$ = g.SIJISK.2$
			g.strSyuyo$ = g.SIJISK.3$
			g.strKumitsukeku$ = g.SIJISK.4$
			g.strSeiriNo$ = g.SIJISK.5$
		ENDIF

		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "けんつば読取        ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "             M2:戻る", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'入力制御
		strInKey$ = M2.KEY
		'入力待ち(M2 or QR)
		W$ = FunInpGet$(strInKey$, 1, "Q:")
		If strQR$ <> "" Then

			'切り出した値'
			strKanbanSyurui$ = SIDensoQR.Decode$(strQR$,"100",2,1)'かんばん種類'
			strTHinban$ = SIDensoQR.Decode$(strQR$,"101",VAL(Mid$(strQR$,28,2)),1)'得意先品番'
			strTHinbanS$ = SIDensoQR.Decode$(strQR$,"543",VAL(Mid$(strQR$,33,2)),1)'得意先品番識別'
			strID151$ = SIDensoQR.Decode$(strQR$,"151",5,1)
			strID543$ = SIDensoQR.Decode$(strQR$,"543",8,1)
			strID561$ = SIDensoQR.Decode$(strQR$,"561",14,1)
			'けんつばかチェック
			If  Mid$(strQR$,1,4) = "JAMA" AND Mid$(strQR$,5,6) = "506002" AND LEN(strQR$) <> 119 AND LEN(strQR$) <> 124 AND strKanbanSyurui$ = "00" AND LEN(strTHinban$) <> 18 AND LEN(strTHinbanS$) <> 14 AND strID151$ = "" AND strID543$ = "" AND strID561$ = "" Then
				'けんつば取得'
				KentsubaSplit(strQR$,VAL(Mid$(strQR$,28,2)),VAL(Mid$(strQR$,33,2)),VAL(Mid$(strQR$,48,2)))
				strHinban$ = g.SYJISK.35$		'デンソー品番'
				strHouso$ = g.SYJISK.36$		'包装'
				strSuryo$ = g.SYJISK.37$		'収容数'
				'フラグセット'
				flgLoop% = Lc.True
				'品番チェック'
				If strHinban$ = g.strHinban$ Then
					'包装チェック'
					If strHouso$ = g.strHouso$ Then
						'数量チェック'
						If Trim$(STR$(VAL(strSuryo$))) = Trim$(STR$(VAL(g.strSyuyo$))) Then
							'集荷実績OK(欠品登録)書き込み'
							SyukaWrite("2","OK","")
							'欠品集荷実績書き込み'
							KeppinWKWrite(g.SYJISK.35$,g.SYJISK.36$,g.strSyuyo$,g.SYJISK.38$,g.strSeiriNo$)
							'欠品チェック'
							g.strKeppinCheck$ = "1"
							'---集荷完了画面
							NextScreen.Set("2050")
						Else
							'集荷実績NG書き込み'
							SyukaWrite("2","NG","2")
							Call NG.Beep
							SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
							iMsg.Text$(1) = "正：" + Trim$(STR$(VAL(g.strSyuyo$)))
							iMsg.Text$(2) = "誤：" + Trim$(STR$(VAL(strSuryo$)))
							WHILE flgLoop% = Lc.True
								intRet% = Lc.True
								pPopRET$ = SIMsgBox.PopUp$(7, "数量エラー", iMsg.Text$(), 2, Lc.MSG.QRREAD)
								IF LEN(strQR$) = 10 THEN
									flgLoop% = Lc.False
								END IF
							WEND
						ENDIF
					Else
						'集荷実績NG書き込み'
						SyukaWrite("2","NG","1")
						Call NG.Beep
						SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
						iMsg.Text$(1) = "正：" + g.strHouso$
						iMsg.Text$(2) = "誤：" + strHouso$
						WHILE flgLoop% = Lc.True
							intRet% = Lc.True
							pPopRET$ = SIMsgBox.PopUp$(7, "包装エラー", iMsg.Text$(), 2, Lc.MSG.QRREAD)
							IF LEN(strQR$) = 10 THEN
								flgLoop% = Lc.False
							END IF
						WEND
					ENDIF
				Else
					'集荷実績NG書き込み'
					SyukaWrite("2","NG","0")
					'品番エラー
					Call NG.Beep
					SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
					iMsg.Text$(1) = "正：" + g.strHinban$
					iMsg.Text$(2) = "誤：" + strHinban$
					WHILE flgLoop% = Lc.True
						intRet% = Lc.True
						pPopRET$ = SIMsgBox.PopUp$(7, "品番エラー", iMsg.Text$(), 2, Lc.MSG.QRREAD)
						IF LEN(strQR$) = 10 THEN
							flgLoop% = Lc.False
						END IF
					WEND
				END IF
			ELSE
				'----けんつばでない場合はエラー
				Call NG.Beep
				SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
				iMsg.Text$(1) = "欠品けんつば"
				iMsg.Text$(2) = "ではありません"
				If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
				Endif
			Endif
		ELSE
			SELECT CASE W$
				CASE M2.KEY	'戻る
					'---欠品看板読取
					NextScreen.Set(g.strStageNo$)
			END SELECT
		END IF

	 WEND
 End Sub

'*************************************************************************************************************************************************
'	[2050]集荷完了
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.SyukaComplete

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	DIM intRet%
	DIM flgLoop%
	DIM pPopRET$

	Private strWhere$(6)[50] 'ファイルサーチ条件
	Private strCheckNo$	'重複チェックNo
	Private iSrchCnt&

	WHILE strSyoriHensu$ = "2050"
		Cls
		if g.intFlg& = 1 THEN
			Call Comple.Beep
		ELSE
				SIJISK.Del(g.intRecSIJI&)
				'指示書すべて完了時完了音鳴らす'
				if SIJISK.Cnt& = 0 THEN
					Call Comple.Beep
				endif
		ENDIF


		'--固定部分
		'タイトル表示
		if g.strKeppinCheck$ = "1" Then
			CALL SetTitle(SyukaMenu.NAME$, Lc.Col.Black, Lc.Col.Yellow, 1, 1)
			g.strKeppinCheck$ = "0"
		Else
			CALL SetTitle(SyukaMenu.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)
		EndIF

		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 5, "品番:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 7, "包装:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 9, "収容数:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 11, "組付区:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 13, "整理No:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'SIText.Print( 1, 15, "指示書:000枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 6, 5, g.strHinban$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 6, 7, g.strHouso$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 9, Trim$(g.strSyuyo$), Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 11, g.strKumitsukeku$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 13, g.strSeiriNo$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'指示書作成無し'
		if g.intFlg& = 1 THEN
			SIText.Print( 1, 15, "指示書:000枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		ELSE
			'指示書実績取得'
			'if g.intRecSIJI& > 1 Then
				'SIJISK.Get(g.intRecSIJI&)
			'ELSE
				'g.intRecSIJI& = 1
				'SIJISK.Get(g.intRecSIJI&)
			'endif
			SIText.Print( 1, 15, "指示書:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			SIText.Print( 8, 15, ZeroUme$(SIJISK.Cnt&,3) + "枚", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		endif

		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "集荷完了!           ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "            ENT:ﾒﾆｭｰ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "             M2:次へ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'入力制御
		strInKey$ = M2.KEY + ENT.KEY

		'入力待ち(M2 or QR)
		W$ = FunInpGet$(strInKey$, 0, "")


		SELECT CASE W$

			CASE M2.KEY	'次へ
			'指示書作成無し'
			if g.intFlg& = 1 THEN
				'NextScreen.Set("2010")
				NextScreen.Set("0000")
			ELSE
				'if SIJISK.Cnt& >= g.intRecSIJI& THEN
				if SIJISK.Cnt& > 0 THEN
					'g.intRecSIJI& = g.intRecSIJI& + 1
					g.intRecSIJI& = 0
					'---かんばん読取指示書実績有
					NextScreen.Set("2015")

				Else
					g.intRecSIJI& = 0
					SIJISK.Kill
					'---かんばん読取指示書
					'NextScreen.Set("2000")
					'---ﾒﾆｭｰ画面
					NextScreen.Set("0000")
				ENDIF
			ENDIF

			CASE ENT.KEY	'ﾒﾆｭｰ
				'---ﾒﾆｭｰ画面
				NextScreen.Set("0000")
		END SELECT


	 WEND
 End Sub





'=========================================↑集荷作業============================================================================================================================='
'=========================================↓指示集荷============================================================================================================================='

'*************************************************************************************************************************************************
'	[3000]指示QR読取
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.SijiSyuka

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	DIM intRet%
	DIM flgLoop%
	DIM pPopRET$

	Private strWhere$(6)[50] 'ファイルサーチ条件
	Private iWhereCnt&'ファイル検索件数'
	Private strCheckNo$	'重複チェックNo
	Private iSrchCnt&
	Private strHouso$'包装'
	Private strHinban$'品番'
	Private strSuryo$'数量'
	Private strKanbanSyurui$'かんばん種類'
	Private strRoke$'製品ロケーション'
	Private strTraceID$'トレースID'
	Private strHakkouTime$'発行年月日時'

	WHILE strSyoriHensu$ = "3000"
		Cls

		'--固定部分
		'タイトル表示
		CALL SetTitle(ShiziSyuka.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)

		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 5, "品番:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 7, "包装:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 9, "収容数:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 11, "組付区:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 13, "整理No:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "トレースカード読取  ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "             M2:戻る", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'入力制御
		strInKey$ = M2.KEY

		'入力待ち(M2 or QR)
		W$ = FunInpGet$(strInKey$, 1, "Q:")

		If strQR$ <> "" Then
			'集荷実績のレコード数チェック
			If SYJISK.Cnt& < 10000 Then	'10000件
				If Mid$(strQR$,1,4) = "JAMA" Then
					IF LEN(strQR$) = 124 THEN
						'--------社内かんばん集荷実績-------'
						kanbanSplit(strQR$)

						'重複条件(集荷実績)'
						strWhere$(0) = .Equal+Chr$(13) + g.SYJISK.13$		'かんばん種類
						strWhere$(1) = .Equal+Chr$(16) + g.SYJISK.16$		'ﾃﾞﾝｿｰ品番
						strWhere$(2) = .Equal+Chr$(17) + g.SYJISK.17$		'包装
						strWhere$(3) = .Equal+Chr$(19) + g.SYJISK.19$		'組付区
						strWhere$(4) = .Equal+Chr$(21) + g.SYJISK.21$		'整理No
						strWhere$(5) = .Equal+Chr$(41) + "OK"					'照合結果
						iWhereCnt& = 6

						'集荷実績ファイル検索
						iSrchCnt& = SYJISK.Srch&(.fcAndSrch, strWhere$, iWhereCnt&, 1, 0)
						If iSrchCnt& < 1 Then
							'集荷実績書き込み'
							SyukaWrite("1","OK","")
							'グローバル保持'
							g.strSiziHinban$ = g.SYJISK.16$
							g.strSiziHouso$ = g.SYJISK.17$
							g.strSiziSyuyo$ = g.SYJISK.18$
							g.strSiziKumitsukeku$ = g.SYJISK.19$
							g.strSiziSeiriNo$ = g.SYJISK.21$
							'---指示書集荷完了----
							NextScreen.Set("3010")
						Else
							'----重複の場合はエラー
							Call NG.Beep
							SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
							iMsg.Text$(1) = "読取済みの"
							iMsg.Text$(2) = "品番です"
							If SIMsgBox.PopUp$(7, "重複読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
							Endif
						END IF

					ELSE
						'--------トレースカード集荷実績-------'
						'トレースカード取得'
						TraceCardSplit(strQR$)
						strKanbanSyurui$ = SIDensoQR.Decode$(strQR$,"100",2,1)
						'strRoke$ = SIDensoQR.Decode$(strQR$,"151",5,1)
						strTraceID$ = SIDensoQR.Decode$(strQR$,"543",8,1)
						strHakkouTime$ = SIDensoQR.Decode$(strQR$,"561",14,1)
						'トレースカードがチェック
						If  Mid$(strQR$,5,6) = "506002"  AND strKanbanSyurui$ = "00" AND strTraceID$ <> "" AND strHakkouTime$ <> "" Then

							'重複条件(集荷実績)'
							strWhere$(0) = .Equal+Chr$(24) + g.SYJISK.24$		'デンソー品番
							strWhere$(1) = .Equal+Chr$(25) + g.SYJISK.25$		'包装区分
							strWhere$(2) = .Equal+Chr$(30) + g.SYJISK.30$		'整理No
							strWhere$(3) = .Equal+Chr$(31) + g.SYJISK.31$		'トレースID
							strWhere$(4) = .Equal+Chr$(32) + g.SYJISK.32$		'発行年月日
							strWhere$(5) = .Equal+Chr$(41) + "OK"		'照合結果
							'集荷実績ファイル検索
							iSrchCnt& = SYJISK.Srch&(.fcAndSrch, strWhere$, 6, 1, 0)
							'重複チェック
							If iSrchCnt& < 1 Then
								'集荷実績書き込み'
								SyukaWrite("1","OK","")
								'グローバル保持'
								g.strSiziHinban$ = g.SYJISK.24$
								g.strSiziHouso$ = g.SYJISK.25$
								g.strSiziSyuyo$ = g.SYJISK.26$
								g.strSiziKumitsukeku$ = g.SYJISK.27$
								g.strSiziSeiriNo$ = g.SYJISK.30$
								'---指示書集荷完了----
								NextScreen.Set("3010")
							ELSE
								'----重複の場合はエラー
								Call NG.Beep
								SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
								iMsg.Text$(1) = "読取済みの"
								iMsg.Text$(2) = "品番です"
								If SIMsgBox.PopUp$(7, "重複読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
								Endif
							endif
						Else
							'----トレースカード、社内かんばんでない場合はエラー
								Call NG.Beep
								SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
								iMsg.Text$(1) = "読取QR"
								iMsg.Text$(2) = "ではありません"
								If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
								Endif

						ENDIF

					ENDIF

				ELSE
					'----トレースカード、社内かんばんでない場合はエラー
							Call NG.Beep
							SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
							iMsg.Text$(1) = "読取QR"
							iMsg.Text$(2) = "ではありません"
							If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
							Endif
				ENDIF
			ELSE
					'---集荷実績が1万件以上の場合はエラー
					Call NG.Beep
					SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
					iMsg.Text$(1) = "実績データ保持"
					iMsg.Text$(2) = "最大件数到達。"
					iMsg.Text$(3) = "実績データを"
					iMsg.Text$(4) = "送信して下さい。"
					If SIMsgBox.PopUp$(7, "最大件数超過", iMsg.Text$(), 4, Lc.MSG.OKONLY) = M1.KEY Then
					Endif

			endif
		ELSE
			SELECT CASE W$
				CASE M2.KEY	'戻る
					'---ﾒﾆｭ-
					NextScreen.Set("0000")
			END SELECT
		END IF

	 WEND
 End Sub


'*************************************************************************************************************************************************
'	[3010]指示集荷完了
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.SyukaSijiComplete

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	DIM intRet%
	DIM flgLoop%
	DIM pPopRET$

	Private strWhere$(6)[50] 'ファイルサーチ条件
	Private strCheckNo$	'重複チェックNo
	Private iSrchCnt&

	WHILE strSyoriHensu$ = "3010"
		Cls
		'完了音'
		Call Comple.Beep

		'--固定部分
		'タイトル表示
		CALL SetTitle(ShiziSyuka.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)

		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 5, "品番:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 7, "包装:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 9, "収容数:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 11, "組付区:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 13, "整理No:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		SIText.Print( 6, 5, g.strSiziHinban$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 6, 7, g.strSiziHouso$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 9, g.strSiziSyuyo$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 11, g.strSiziKumitsukeku$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 13, g.strSiziSeiriNo$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "指示集荷完了!       ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "            ENT:ﾒﾆｭｰ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "             M2:次へ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'入力制御
		strInKey$ = M2.KEY + ENT.KEY

		'入力待ち(M2 or QR)
		W$ = FunInpGet$(strInKey$, 0, "")

		SELECT CASE W$
			CASE M2.KEY	'次へ
				NextScreen.Set("3000")
			CASE ENT.KEY	'ﾒﾆｭｰ
				'---ﾒﾆｭｰ画面
				NextScreen.Set("0000")
		END SELECT


	 WEND
 End Sub
'=========================================↑指示集荷============================================================================================================================='

'=========================================↓欠品集荷作業============================================================================================================================='

'*************************************************************************************************************************************************
'	[4000]欠品集荷かんばん読取
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.KeppinSyukaReadKanban

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	DIM intRet%
	DIM flgLoop%
	DIM pPopRET$

	Private strWhere$(7)[50] 'ファイルサーチ条件
	Private strKeppinWhere$(7)[50] 'ファイルサーチ条件欠品実績
	Private iWhereCnt&'ファイル検索件数'
	Private iWhereCnt2&'ファイル検索件数欠品実績'
	Private strCheckNo$	'重複チェックNo
	Private iSrchCnt&
	Private iSrchCnt2&


	WHILE strSyoriHensu$ = "4000"
		Cls

		'--固定部分
		'タイトル表示
		CALL SetTitle(KeppinSyuka.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)

		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 5, "品番:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 7, "包装:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 9, "収容数:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 11, "組付区:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 13, "整理No:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "かんばん読取        ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "             M2:戻る", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'入力制御
		strInKey$ = M2.KEY

		'入力待ち(M2 or QR)
		W$ = FunInpGet$(strInKey$, 1, "Q:")

		If strQR$ <> "" Then
			'集荷実績のレコード数チェック
			If SYJISK.Cnt& < 10000 Then	'10000件
				'かんばんかチェック
				If  Len(strQR$) = 119 OR Len(strQR$) = 124 Then
					'先頭4桁がJAMAか判定
					If Mid$(strQR$,1,4) = "JAMA" Then
						'eかんばんか社内かんばんか'
						If  Len(strQR$) = 119 THEN
							'eかんばん分割'
							EkanbanSplit(strQR$)

							'重複条件(集荷実績)'
							strWhere$(0) = .Equal+Chr$(3) + "3"		'パターン
							strWhere$(1) = .Equal+Chr$(5) + g.SYJISK.5$		'デンソー品番
							strWhere$(2) = .Equal+Chr$(6) + g.SYJISK.6$		'包装
							strWhere$(3) = .Equal+Chr$(8) + g.SYJISK.8$		'整理番号
							strWhere$(4) = .Equal+Chr$(10) + g.SYJISK.10$		'納入日
							strWhere$(5) = .Equal+Chr$(41) + "OK"					'照合結果
							iWhereCnt& = 6
							'変数入れる'
							KeppinGlobal(g.SYJISK.5$,g.SYJISK.6$,g.SYJISK.7$,"",g.SYJISK.8$)

							'重複条件(欠品実績WK)'
							strKeppinWhere$(0) = .Equal+Chr$(3) + g.SYJISK.5$		'デンソー品番
							strKeppinWhere$(1) = .Equal+Chr$(4) + g.SYJISK.6$		'包装
							strKeppinWhere$(2) = .Equal+Chr$(5) + g.SYJISK.7$		'収容数
							strKeppinWhere$(3) = .Equal+Chr$(7) + g.SYJISK.8$		'整理No
							iWhereCnt2& = 4
						ELSE
							'社内かんばん分割'
							kanbanSplit(strQR$)

							'重複条件(集荷実績)'
							strWhere$(0) = .Equal+Chr$(3) + "3"		'パターン
							strWhere$(1) = .Equal+Chr$(13) + g.SYJISK.13$		'かんばん種類
							strWhere$(2) = .Equal+Chr$(16) + g.SYJISK.16$		'ﾃﾞﾝｿｰ品番
							strWhere$(3) = .Equal+Chr$(17) + g.SYJISK.17$		'包装
							strWhere$(4) = .Equal+Chr$(19) + g.SYJISK.19$		'組付区
							strWhere$(5) = .Equal+Chr$(21) + g.SYJISK.21$		'整理No
							strWhere$(6) = .Equal+Chr$(41) + "OK"					'照合結果
							iWhereCnt& = 7
							'変数入れる'
							KeppinGlobal(g.SYJISK.16$,g.SYJISK.17$,g.SYJISK.18$,g.SYJISK.19$,g.SYJISK.21$)

							'重複条件(欠品実績WK)'
							strKeppinWhere$(0) = .Equal+Chr$(3) + g.SYJISK.16$		'品番
							strKeppinWhere$(1) = .Equal+Chr$(4) + g.SYJISK.17$		'包装
							strKeppinWhere$(2) = .Equal+Chr$(5) + g.SYJISK.18$		'収容数
							strKeppinWhere$(3) = .Equal+Chr$(7) + g.SYJISK.21$		'整理No
							iWhereCnt2& = 4

						endif

						'ファイル検索
						iSrchCnt& = SYJISK.Srch&(.fcAndSrch, strWhere$, iWhereCnt&, 1, 0)
						g.intKeppinNo& = KEJISK.Srch&(.fcAndSrch, strKeppinWhere$, iWhereCnt2&, 1, 0)

						'集荷実績重複チェック'
						If iSrchCnt& < 1 Then
							'欠品集荷実績重複チェック'
							If g.intKeppinNo& > 0 Then

								'---トレースカード読取画面をセット
								NextScreen.Set("4010")
							Else
								'----欠品データがない場合はエラー
								Call NG.Beep
								SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
								iMsg.Text$(1) = "欠品データ"
								iMsg.Text$(2) = "ではありません"
								If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
								Endif
							END IF

						Else
							'----重複の場合はエラー
							Call NG.Beep
							SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
							iMsg.Text$(1) = "読取済みの"
							iMsg.Text$(2) = "かんばんです"

							WHILE flgLoop% = Lc.True
								intRet% = Lc.True
								pPopRET$ = SIMsgBox.PopUp$(7, "重複読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY)
								IF LEN(strQR$) = 10 THEN
									flgLoop% = Lc.False
								END IF
							WEND
						END IF
					ELSE
						'----かんばんでない場合はエラー
						Call NG.Beep
						SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
						iMsg.Text$(1) = "かんばん"
						iMsg.Text$(2) = "ではありません"
						If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
						Endif
					END IF
				ELSE
					'----かんばんでない場合はエラー
					Call NG.Beep
					SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
					iMsg.Text$(1) = "かんばん"
					iMsg.Text$(2) = "ではありません"
					If Len(SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY)) = 10 Then
					Endif
				Endif
			ELSE
				'---集荷実績が1万件以上の場合はエラー
				Call NG.Beep
				SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
				iMsg.Text$(1) = "実績データ保持"
				iMsg.Text$(2) = "最大件数到達。"
				iMsg.Text$(3) = "実績データを"
				iMsg.Text$(4) = "送信して下さい。"
				If SIMsgBox.PopUp$(7, "最大件数超過", iMsg.Text$(), 4, Lc.MSG.OKONLY) = M1.KEY Then
				Endif
			END IF
		ELSE
			SELECT CASE W$
				CASE M2.KEY	'戻る
					'---メニュー画面をセット
					NextScreen.Set("0000")

			END SELECT
		END IF

	 WEND
 End Sub

'*************************************************************************************************************************************************
'	[4010]欠品集荷トレース読取
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.KeppinReadTraceCard

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	DIM intRet%
	DIM flgLoop%
	DIM pPopRET$

	Private strWhere$(7)[50] 'ファイルサーチ条件
	Private strCheckNo$	'重複チェックNo
	Private iSrchCnt&
	Private strHouso$'包装'
	Private strHinban$'品番'
	Private strSuryo$'数量'
	Private strKanbanSyurui$'かんばん種類'
	Private strRoke$'製品ロケーション'
	Private strTraceID$'トレースID'
	Private strHakkouTime$'発行年月日時'

	WHILE strSyoriHensu$ = "4010"
		Cls

		'--固定部分
		'タイトル表示
		CALL SetTitle(KeppinSyuka.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)

		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 5, "品番:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 7, "包装:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 9, "収容数:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 11, "組付区:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 13, "整理No:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		SIText.Print( 6, 5, g.strKeppinHinban$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 6, 7, g.strKeppinHouso$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 9, g.strKeppinSyuyo$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 11, g.strKeppinKumitsukeku$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 13, g.strKeppinSeiriNo$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "トレースカード読取  ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "             M2:戻る", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'入力制御
		strInKey$ = M2.KEY

		'入力待ち(M2 or QR)
		W$ = FunInpGet$(strInKey$, 1, "Q:")

		If strQR$ <> "" Then
			strKanbanSyurui$ = SIDensoQR.Decode$(strQR$,"100",2,1)
			'strRoke$ = SIDensoQR.Decode$(strQR$,"151",5,1)
			strTraceID$ = SIDensoQR.Decode$(strQR$,"543",8,1)
			strHakkouTime$ = SIDensoQR.Decode$(strQR$,"561",14,1)

			'トレースカードがチェック
			If  Mid$(strQR$,1,4) = "JAMA" AND Mid$(strQR$,5,6) = "506002"  AND strKanbanSyurui$ = "00" AND strTraceID$ <> "" AND strHakkouTime$ <> "" Then
				'トレースカード取得'
				TraceCardSplit(strQR$)
				strHinban$ = g.SYJISK.24$
				strHouso$ = g.SYJISK.25$
				strSuryo$ = g.SYJISK.26$

			'フラグセット'
				flgLoop% = Lc.True
				'品番チェック'
				If strHinban$ = g.strKeppinHinban$ Then
					'包装チェック'
					If strHouso$ = g.strKeppinHouso$ Then
						'数量チェック
						'2021/05/10 修正前Trim$(strSuryo$) = Trim$(g.strKeppinSyuyo$)'
						If VAL(strSuryo$) = VAL(g.strKeppinSyuyo$) Then
							'集荷実績OK書き込み'
							SyukaWrite("3","OK","")
							'対象欠品集荷実績削除'
							KEJISK.Del(g.intKeppinNo&)
							'---欠品集荷完了画面
							NextScreen.Set("4020")
						Else
							'集荷実績NG書き込み'
							SyukaWrite("3","NG","2")
							Call NG.Beep
							SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
							iMsg.Text$(1) = "正：" + g.strKeppinSyuyo$
							iMsg.Text$(2) = "誤：" + strSuryo$
							WHILE flgLoop% = Lc.True
								intRet% = Lc.True
								pPopRET$ = SIMsgBox.PopUp$(7, "数量エラー", iMsg.Text$(), 2, Lc.MSG.QRREAD)
								IF LEN(strQR$) = 10 THEN
									flgLoop% = Lc.False
								END IF
							WEND
						ENDIF
					Else
						'集荷実績NG書き込み'
						SyukaWrite("3","NG","1")
						Call NG.Beep
						SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
						iMsg.Text$(1) = "正：" + g.strKeppinHouso$
						iMsg.Text$(2) = "誤：" + strHouso$
						WHILE flgLoop% = Lc.True
							intRet% = Lc.True
							pPopRET$ = SIMsgBox.PopUp$(7, "包装エラー", iMsg.Text$(), 2, Lc.MSG.QRREAD)
							IF LEN(strQR$) = 10 THEN
								flgLoop% = Lc.False
							END IF
						WEND
					ENDIF
				Else
					'集荷実績NG書き込み'
					SyukaWrite("3","NG","0")
					'品番エラー
					Call NG.Beep
					SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
					iMsg.Text$(1) = "正：" + g.strKeppinHinban$
					iMsg.Text$(2) = "誤：" + strHinban$
					WHILE flgLoop% = Lc.True
						intRet% = Lc.True
						pPopRET$ = SIMsgBox.PopUp$(7, "品番エラー", iMsg.Text$(), 2, Lc.MSG.QRREAD)
						IF LEN(strQR$) = 10 THEN
							flgLoop% = Lc.False
						END IF
					WEND
				END IF
			ELSE
				'----トレースカードでない場合はエラー
				Call NG.Beep
				SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Red, Lc.Col.Black, Lc.Col.Pink, Lc.Col.Black, Lc.Col.20Gray)
				iMsg.Text$(1) = "トレースカード"
				iMsg.Text$(2) = "ではありません"
				If SIMsgBox.PopUp$(7, "読取エラー", iMsg.Text$(), 2, Lc.MSG.OKONLY) = M1.KEY Then
				Endif
			Endif

		ELSE
			SELECT CASE W$
				CASE M2.KEY	'戻る
					'---欠品集荷かんばん読取
					NextScreen.Set("4000")
			END SELECT
		END IF

	 WEND
 End Sub

'*************************************************************************************************************************************************
'	[4020]欠品集荷完了
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.KeppinSyukaComplete

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	DIM intRet%
	DIM flgLoop%
	DIM pPopRET$

	Private strWhere$(6)[50] 'ファイルサーチ条件
	Private strCheckNo$	'重複チェックNo
	Private iSrchCnt&

	WHILE strSyoriHensu$ = "4020"
		Cls
		'完了音'
		Call Comple.Beep

		'--固定部分
		'タイトル表示
		CALL SetTitle(SyukaMenu.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)

		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 5, "品番:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 7, "包装:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 9, "収容数:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 11, "組付区:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 13, "整理No:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		SIText.Print( 6, 5, g.strKeppinHinban$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 6, 7, g.strKeppinHouso$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 9, g.strKeppinSyuyo$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 11, g.strKeppinKumitsukeku$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 13, g.strKeppinSeiriNo$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "欠品集荷完了!       ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "            ENT:ﾒﾆｭｰ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'入力制御
		if KEJISK.Cnt& = 0 Then
			SIText.Print( 1,24, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			strInKey$ = M1.KEY + ENT.KEY
		ELSE
			SIText.Print( 1,24, "             M2:次へ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			strInKey$ = M2.KEY + ENT.KEY
		endif
		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'入力待ち(M2)
		W$ = FunInpGet$(strInKey$, 0, "")
		SELECT CASE W$

			CASE M2.KEY	'次へ
				NextScreen.Set("4000")
			CASE ENT.KEY	'ﾒﾆｭｰ
				'---ﾒﾆｭｰ画面
				NextScreen.Set("0000")
		END SELECT


	 WEND
 End Sub


'=========================================↑欠品集荷作業============================================================================================================================='

'=========================================↓欠品削除============================================================================================================================='
'*************************************************************************************************************************************************
'	[5000]欠品削除
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.KeppinDelete

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	DIM strListData$(8)[25]
	DIM intListCnt%
	DIM flgLoop%
	Private intMax%,intToo% '配列要素数、余り
	Private intNext%
	Private intNumber%'実績行番号'
	Private strDeleteNum$'削除行'

	'欠品実績件数取得'
	intMax% = KEJISK.Cnt&

	'ページ数確認
	g.intMaxP& = intMax% / 7
	intToo% = intMax% MOD 7

	'ページ数確定'
	IF intMax% >= 7 Then
		IF intToo% > 0 Then
			g.intMaxP& = g.intMaxP& + 1
		ENDIF
	Else
		g.intMaxP& = g.intMaxP& + 1
	ENDIF

	'画面処理
	WHILE strSyoriHensu$ = "5000"

		Cls

		SIList.Cursor& = 1		'配列内のカーソルの行
		SIList.TopPos& = 1		'スクリーンのTOP行

		'リストデータ初期化'
		For intNext% = 1 To 7
			strListData$(intNext%) = ""
		Next intNext%

		'データセット'
		intNext% = 1
		flgLoop% = Lc.True
		WHILE flgLoop% = Lc.True
			IF intNext% > 7 OR g.intPage& * 7 + intNext% > KEJISK.Cnt& Then
				flgLoop% = Lc.False

			Else
				'データ取得'
				intNumber% = g.intPage& * 7 + intNext%
				KEJISK.Get(intNumber%)
				strListData$(intNext%) = ZeroUme$(intNumber%,3) + ":" + g.KEJISK.3$ + "  " + g.KEJISK.4$
				'ﾒﾆｭｰ項目数
				intListCnt% = intNext%
			EndIF
			intNext% = intNext% + 1
		WEND

		'--固定部分
		'タイトル表示
		CALL SetTitle(KeppinDelete.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 3, "実績:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 6, 3, ZeroUme$(intMax%,3) + "件", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		IF KEJISK.Cnt& > 0 Then
			if intToo% = 0 then
				SIText.Print( 12, 3, "<" + ZeroUme$(g.intPage& + 1,3) + "/" + ZeroUme$(g.intMaxP&,3) + ">", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			else
				SIText.Print( 12, 3, "<" + ZeroUme$(g.intPage& + 1,3) + "/" + ZeroUme$(g.intMaxP&,3) + ">", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			END IF
		Else
			SIText.Print( 12, 3, "<000/000>", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		ENDIF

		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)

		'1ページのみ'
		IF g.intPage& + 1 = 1 Then
			SIText.Print( 1,20, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'リスト表示 & 入力待ち
			strInKey$ = M1.KEY + M2.KEY
		ENDIF
		'2ページ目で次頁有り'
		IF g.intMaxP& > g.intPage& + 1 Then
			SIText.Print( 1,20, "←F7:前頁  F8:次頁→", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'リスト表示 & 入力待ち
			strInKey$ = M1.KEY + M2.KEY + F7.KEY + F8.KEY
		ENDIF
		'1ページ目かつ次頁有り'
		IF g.intPage& + 1 = 1 AND g.intMaxP& > g.intPage& + 1 Then
			SIText.Print( 1,20, "           F8:次頁→", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'リスト表示 & 入力待ち
			strInKey$ = M1.KEY + M2.KEY + F8.KEY
		ENDIF
		'最大ページ時'
		IF g.intPage& + 1 = g.intMaxP& AND g.intMaxP& <> 1 Then
			SIText.Print( 1,20, "←F7:前頁           ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'リスト表示 & 入力待ち
			strInKey$ = M1.KEY + M2.KEY  + F7.KEY
		ENDIF

		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "▲▼:スクロール      ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "M1:詳細      M2:戻る", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIFont.Reset

		W$ = SIList$( 1, 6, 7, 20, strListData$, intListCnt%, strInKey$)
		SELECT W$
			CASE M1.KEY	'送信
				'--
				'選択されたリスト項目Noを取得
				strDeleteNum$ = MID$(strListData$(SIList.Cursor&),1,3)
				'対象番号保持'
				g.intDeleteNumber& = VAL(strDeleteNum$)
				NextScreen.Set("5010")

			CASE M2.KEY	'戻る
				'---ﾒﾆｭｰ画面
				NextScreen.Set("0000")

			CASE F7.KEY	'前頁
				g.intPage& = g.intPage& - 1
			CASE F8.KEY	'次頁
				g.intPage& = g.intPage& + 1
		END SELECT
	WEND
 End Sub

'*************************************************************************************************************************************************
'	[5010]欠品詳細
'	引数：なし
'	戻り値：なし
'*************************************************************************************************************************************************
 Sub Scrn.KeppinDeleteDetail

	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	DIM strListData$(8)[25]
	DIM intListCnt%
	DIM flgLoop%
	Private intMax%,intToo% '配列要素数、余り
	Private intNext%
	Private intNumber%'実績行番号'
	Private strDeleteNum$'削除行'



	'画面処理
	WHILE strSyoriHensu$ = "5010"

		Cls
		'欠品実績件数取得'
		intMax% = KEJISK.Cnt&

		'データ取得'
		KEJISK.Get(g.intDeleteNumber&)
		'--固定部分
		'タイトル表示
		CALL SetTitle(KeppinDelete.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Small.BackColor)
		SIText.Print( 1, 3, MID$(g.KEJISK.2$,5,2) + "/" + MID$(g.KEJISK.2$,7,2) + " " + MID$(g.KEJISK.2$,9,2) + ":" + MID$(g.KEJISK.2$,11,2), Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 12, 3, "<" + ZeroUme$(g.intDeleteNumber&,3) + "/" + ZeroUme$(intMax%,3) + ">", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'固定項目'
		SIText.Print( 1, 7, "品番:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 9, "包装:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 11, "収容数:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 13, "組付区:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 15, "整理No:", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		'データ'
		SIText.Print( 6, 7, g.KEJISK.3$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 6, 9, g.KEJISK.4$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 11, g.KEJISK.5$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 13, g.KEJISK.6$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 8, 15, g.KEJISK.7$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "欠品詳細            ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)

		'先頭データの場合'
		IF g.intDeleteNumber& = 1 Then
			SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'リスト表示 & 入力待ち
			strInKey$ = M1.KEY + M2.KEY
		ENDIF
		'2ページ目で次頁有り'
		IF intMax% > g.intDeleteNumber& Then
			SIText.Print( 1,22, "←F7:前頁  F8:次頁→", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'リスト表示 & 入力待ち
			strInKey$ = M1.KEY + M2.KEY + F7.KEY + F8.KEY
		ENDIF
		'1ページ目かつ次頁有り'
		IF g.intDeleteNumber& = 1 AND intMax% > g.intDeleteNumber& Then
			SIText.Print( 1,22, "           F8:次頁→", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'リスト表示 & 入力待ち
			strInKey$ = M1.KEY + M2.KEY + F8.KEY
		ENDIF
		'最大ページ時'
		IF g.intDeleteNumber& = intMax% AND intMax% <> 1 Then
			SIText.Print( 1,22, "←F7:前頁           ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
			'リスト表示 & 入力待ち
			strInKey$ = M1.KEY + M2.KEY  + F7.KEY
		ENDIF

		SIText.Print( 1,24, "M1:削除      M2:戻る", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIFont.Reset

		'入力待ち(M1 + M2 + F7 + F8)
		W$ = FunInpGet$(strInKey$, 0, "")
		SELECT W$
			CASE M1.KEY	'削除
				SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
				Call NG.Beep
				SIMsgBox.SetColor(Lc.Col.White, Lc.Col.Green, Lc.Col.Black, Lc.Col.BrightGreen, Lc.Col.Black, Lc.Col.20Gray)
				iMsg.Text$(1) = "この欠品実績を"
				iMsg.Text$(2) = "削除しますか?"
				IF SIMsgBox.PopUp$(7, "削除確認", iMsg.Text$(), 2, Lc.MSG.OKCANCEL) = M1.KEY  Then
					'---削除完了
					KEJISK.Del(g.intDeleteNumber&)
					NextScreen.Set("5011")

				END IF

			CASE M2.KEY	'戻る
				'---画面
				NextScreen.Set("5000")

			CASE F7.KEY	'前頁
				g.intDeleteNumber& = g.intDeleteNumber& - 1
			CASE F8.KEY	'次頁
				g.intDeleteNumber& = g.intDeleteNumber& + 1
		END SELECT
	WEND
 End Sub

'*******************************************************************************
'	[5011]欠品詳細完了
'	引数：なし
'	戻り値：なし
'*******************************************************************************
 Sub Scrn.KeppinDeleteDetailComplete

	DIM W$

	'画面処理
	WHILE strSyoriHensu$ = "5011"

		Cls

		'--固定部分
		'タイトル表示
		CALL SetTitle(KeppinDelete.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)

		SIText.Print( 1, 8, "      削除完了      ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 10, "      しました      ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'画面表示
		SIFont.Reset
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "M1:次へ             ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset


		'入力待ち(M1)
		W$ = FunInpGet$(M1.KEY, 0, "")

		SELECT CASE W$
			CASE M1.KEY
				g.intPage& = 0
				IF KEJISK.Cnt& > 0 THEN
					'---画面
					NextScreen.Set("5000")
				ELSE
					'---画面
					NextScreen.Set("0000")
				EndIF

		END SELECT

	WEND

 End Sub

'*******************************************************************************
 '	[6000]集荷実績送信確認
 '	引数：なし
 '	戻り値：なし
 '*******************************************************************************
	Sub Scrn.SendSyuka

	DIM W$

	'画面処理
	WHILE strSyoriHensu$ = "6000"

		Cls

		'--固定部分
		'タイトル表示

		CALL SetTitle(ZissekiSend.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)

		SIText.Print( 1, 8, "    実績データを    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 10,"    送信します。    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,20, "集荷実績送信        ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "M1:送信      M2:ﾒﾆｭｰ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'---------------------------
		'	入力待ち
		'---------------------------
		'入力待ち(M1 or M2 or QR)
		W$ = FunInpGet$(M1.KEY + M2.KEY, 0, "")
		SELECT CASE W$
			CASE M1.KEY	'送信
				NextScreen.Set("6010")
			CASE M2.KEY
				'----- 戻る -----
				'[0000]メインﾒﾆｭｰ
				NextScreen.Set("0000")
		END SELECT
	WEND

 End Sub

'*******************************************************************************
'	[6010]送信中
'	引数：なし
'	戻り値：なし
'*******************************************************************************
 Sub Scrn.SendingSyuka

	DIM W$
	DIM strDate$
	DIM JskFileNmtmp$[255]	'一時保存ファイル
	DIM JskFileNmDat$[255]	'リネーム
	DIM flgLoop%
	Private iRet%
	Private iRetOp%,iRetCl%,iRetRn%
	Private ErrorNum$

	''画面処理
	WHILE strSyoriHensu$ = "6010"

		Cls

		'--固定部分
		'タイトル表示
		CALL SetTitle(ZissekiSend.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)
		SIText.Print( 1, 8, "       送信中       ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print(15,10, "バイト", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset
		'---------------------------
		'	実績送信処理
		'---------------------------
		Locate 6,10

		'実績ファイルファイル名作成
		strDate$ = Mid$(Sysdate$(""),1,14)

		JskFileNmtmp$ = "FYVSYJIS" + "_" + SISysSGet$(.syPrdctNo) + "_" + strDate$ + "." + "tmp"
		JskFileNmDat$ = "FYVSYJIS" + "_" + SISysSGet$(.syPrdctNo) + "_" + strDate$ + "." + "DAT"

		'送信完了
		IF YTP.Put%(SYJISK.FileNm$, JskFileNmtmp$, .ftCRLF, .ftUpSTOR, .ftDisp) = Lc.True THEN
			'ファイルリネーム
			iRetRn% = YTP.Rename%(JskFileNmtmp$, JskFileNmDat$)
			'集荷実績削除'
			SYJISK.Kill
			'指示書実績削除'
			SIJISK.Kill
			'送信完了画面へ
			NextScreen.Set("6011")

	 ELSE
		 '送信失敗画面へ
		 NextScreen.Set("6012")
	 END IF
 WEND

 End Sub

'*******************************************************************************
'	[6011]送信完了
'	引数：なし
'	戻り値：なし
'*******************************************************************************
 Sub Scrn.SendSyukaComplete

	DIM W$

	'画面処理
	WHILE strSyoriHensu$ = "6011"

		Cls

		'--固定部分
		'タイトル表示
		CALL SetTitle(ZissekiSend.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)
		SIText.Print( 1, 8, "      送信完了      ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		'SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, Lc.Col.Lavender)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "             M2:ﾒﾆｭｰ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset

		'入力待ち(M2)
		W$ = FunInpGet$(M2.KEY, 0, "")
		SELECT CASE W$
			CASE M2.KEY
				'----- ﾒﾆｭｰ -----
				'ﾒﾆｭｰ
				NextScreen.Set("0000")
		END SELECT
	WEND
 End Sub

'*******************************************************************************
'	[6012]送信失敗
'	引数：なし
'	戻り値：なし
'*******************************************************************************
 Sub Scrn.SendSyukaFailed

	DIM W$
	DIM intRed%
	Private iRetCl%
	'画面処理
	WHILE strSyoriHensu$ = "6012"

		Cls
		Call NG.Beep
		'--固定部分
		'タイトル表示
		CALL SetTitle(ZissekiSend.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)

		'背景赤
		SIFont.Set(Lc.WAT.NORMAL, Small.ForeColor, Lc.Col.Red)
		For intRed% = 3 To 21
			SIText.Print( 1, intRed%,"                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		Next intRed%

		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, Lc.Col.Red)
		SIText.Print( 1, 8, "    [通信エラー]    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1, 10, g.YTP.Message$, Lc.RAT.NORMAL, Lc.BLD.NORMAL)

		SIFont.Reset
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "M1:再送信   M2:ｷｬﾝｾﾙ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)
		SIFont.Reset

		'入力待ち(M1 or M2)
		W$ = FunInpGet$(M1.KEY + M2.KEY, 0, "")

		SELECT CASE W$
			CASE M1.KEY	'再送信
				NextScreen.Set("6010")
			CASE M2.KEY

				NextScreen.Set("0000")
		END SELECT
	WEND
 End Sub


'*******************************************************************************
'	[7000]設定
'	引数：なし
'	戻り値：なし
'*******************************************************************************
 Sub Scrn.SettingMenu
	DIM W$
	DIM strDefInKey$[10], strInKey$[10]
	DIM strListData$(8)[25]
	DIM intListCnt%

	'ﾒﾆｭｰ項目を登録
	strListData$(1) = "     1:あり         1"
	strListData$(2) = "     2:なし         2"

	'ﾒﾆｭｰ項目数
	intListCnt% = 2

	'キー登録
	strDefInKey$ = "12"

	SIList.Cursor& = 1		'配列内のカーソルの行
	SIList.TopPos& = 1		'スクリーンのTOP行


	'画面処理
	WHILE strSyoriHensu$ = "7000"
		strInKey$ = strDefInKey$

		Cls

		'タイトル表示
		CALL SetTitle(Shokuban.NAME$, Hanyou.ForeColor, Hanyou.BackColor, 1, 1)
		SIText.Print( 1, 7, "    指示書作成   ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		'バージョン
		SISystemStatus.Disp(1, HanyouB.BackColor, "Ver." + strVERSION, Lc.COL.BLUE, HanyouB.BackColor)

		'ボタン表示
		SIFont.Button
		SIFont.Set(Lc.WAT.NORMAL, HanyouB.ForeColor, HanyouB.BackColor)
		SIText.Print( 1,22, "                    ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIText.Print( 1,24, "M1:確定      M2:ﾒﾆｭｰ", Lc.RAT.NORMAL, Lc.BLD.NORMAL)
		SIFont.Reset
		'リスト表示 & 入力待ち
		strInKey$ = strInKey$ + M1.KEY + M2.KEY
		W$ = SIList$( 1, 9, 2, 20, strListData$, intListCnt%, strInKey$)

		'キー入力確認
		IF W$ = M1.KEY THEN
			'選択されたリスト項目Noを取得
			W$ = MID$(strListData$(SIList.Cursor&),21,1)
		END IF
		SELECT W$
			CASE "1"
				'設定値消す'
				SEJskWk.Kill
				g.SEJskWk.1$ = "1"
				'設定値入れる'
				SEJskWk.Put(0)
				g.strSetting$ = "1"
				'[0000]
				NextScreen.Set("0000")
			CASE "2"
				'設定値消す'
				SEJskWk.Kill
				g.SEJskWk.1$ = "2"
				'設定値入れる'
				SEJskWk.Put(0)
				g.strSetting$ = "2"
				'[0000]かんばん読取
				NextScreen.Set("0000")
			CASE M2.KEY
				'[0000]メインメニュー
				NextScreen.Set("0000")

		END SELECT
	WEND

 End Sub
